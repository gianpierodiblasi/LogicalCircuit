class LogicalCircuitCore{#t={};#e;#s=["OR","NOR","AND","NAND","XOR","NXOR","NOT","BREAK","CASE","CATCH","CLASS","CONST","CONTINUE","DEBUGGER","DEFAULT","DELETE","DO","ELSE","EXPORT","EXTENDS","FALSE","FINALLY","FOR","FUNCTION","IF","IMPORT","IN","INSTANCEOF","NEW","NULL","RETURN","SUPER","SWITCH","THIS","THROW","TRUE","TRY","TYPEOF","VAR","VOID","WHILE","WITH","LET","STATIC","YIELD","AWAIT","ENUM","IMPLEMENTS","INTERFACE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","ABSTRACT","BOOLEAN","BYTE","CHAR","DOUBLE","FINAL","FLOAT","GOTO","INT","LONG","NATIVE","SHORT","SYNCHRONIZED","THROWS","TRANSIENT","VOLATILE","ARGUMENTS","AS","ASYNC","EVAL","FROM","GET","OF","SET"];#i=["OR","NOR","AND","NAND","XOR","NXOR","NOT"];#o={OR:"||",AND:"&&",XOR:"+",NOR:"||",NAND:"&&",NXOR:"+"};#n={OR:"",AND:"",XOR:"===1",NOR:"",NAND:"",NXOR:"!==1"};constructor(){}setJSON(t){this.#t=JSON.parse(JSON.stringify(t))}getJSON(){return JSON.parse(JSON.stringify(this.#t))}setSimplifier(t){this.#e=t}simplify(){if(this.#e&&this.isValid()){var t={};Object.keys(this.#t).filter((t=>"IN"===this.#t[t].type)).forEach((e=>t[e]={type:"IN"}));var e=!0;return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((s=>{var i=[];this.#h(s,i);for(var o=[],n=0;n<Math.pow(2,i.length);n++){var h={},r=n.toString(2).padStart(i.length,"0");i.forEach(((t,e)=>h[t]=!!parseInt(r[e]))),this.computeExpression(s,h)&&o.push(n)}t[s]={type:"OUT",from:[]};try{var a=this.#e(o);this.#r(t,s,i,a)}catch(t){e=!1}})),e&&(this.#t=t),e}return!1}#h(t,e){"IN"===this.#t[t].type?e.includes(t)||e.push(t):"NOT"===this.#t[t].type?this.#h(this.#t[t].from[0],e):this.#t[t].from.forEach((t=>this.#h(t,e)))}#r(t,e,s,i){if(1===(i=i.split(" OR ")).length)this.#a(t,e,s,i[0]);else{var o=this.#c("OR");t[o]={type:"OR",from:[]},i.forEach((e=>this.#a(t,o,s,e))),t[e].from.push(o)}}#a(t,e,s,i){if(1===(i=i.replace("(","").replace(")","").split(" AND ")).length)this.#l(t,e,s,i[0]);else{var o=this.#c("AND");t[o]={type:"AND",from:[]},i.forEach((e=>this.#l(t,o,s,e))),t[e].from.push(o)}}#l(t,e,s,i){if(i.startsWith("NOT ")){var o=this.#c("NOT");t[o]={type:"NOT",from:[s[i.charCodeAt(4)-65]]},t[e].from.push(o)}else t[e].from.push(s[i.charCodeAt(0)-65])}computeExpressions(t){var e={};return this.isValid()&&Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((s=>e[s]=this.computeExpression(s,t))),e}computeExpression(name,parameters){var result;if(this.isValid()&&this.#t[name]&&"OUT"===this.#t[name].type){var toEval=Object.keys(parameters).reduce(((t,e)=>t+"var "+e+" = "+parameters[e]+";\n"),"");toEval+="result = "+this.getJavaScriptExpression(name)+";",eval(toEval)}return result}getJavaScriptExpressions(){var t={};return this.isValid()&&Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t[e]=this.#d(this.#t[e].from[0],!1))),t}getJavaScriptExpression(t){return this.isValid()&&this.#t[t]&&"OUT"===this.#t[t].type?this.#d(this.#t[t].from[0],!1):""}#d(t,e){if("IN"===this.#t[t].type)return t;if("NOT"===this.#t[t].type)return"!"+this.#d(this.#t[t].from[0],!0);var s=this.#t[t].from.map((t=>this.#d(t,!0)));switch(this.#t[t].type){case"OR":case"AND":case"XOR":case"NXOR":return(e?"(":"")+s.join(this.#o[this.#t[t].type])+this.#n[this.#t[t].type]+(e?")":"");case"NOR":case"NAND":return"!("+s.join(this.#o[this.#t[t].type])+")"}}isValid(){return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).reduce(((t,e)=>t&&this.#u(e)),!0)}#u(t){var e=!0;return this.#t[t].from.forEach((t=>{(e&=!!t)&&"IN"!==this.#t[t].type&&(e&=!!this.#u(t))})),!!e}isEmpty(){return!Object.keys(this.#t).length}addInput(t){return this.#f(t,{type:"IN"})}addOutput(t){return this.#f(t,{type:"OUT",from:[""]})}addOR(){return this.#p("OR",["",""])}addNOR(){return this.#p("NOR",["",""])}addAND(){return this.#p("AND",["",""])}addNAND(){return this.#p("NAND",["",""])}addXOR(){return this.#p("XOR",["",""])}addNXOR(){return this.#p("NXOR",["",""])}addNOT(){return this.#p("NOT",[""])}#p(t,e){var s=this.#c(t);return this.#f(s,{type:t,from:e},!0),s}#f(t,e,s){return(s||!(!this.isNameValid(t)||this.isNameAlreadyUsed(t)))&&(this.#t[t]=e,!0)}#c(t){return"$_"+t.padEnd(5,"_")+(new Date).getTime()+"_"+parseInt(1e4*Math.random()).toFixed(0).padStart(4,"0")}incConnector(t){this.#t[t]&&!["IN","OUT","NOT"].includes(this.#t[t].type)&&this.#t[t].from.push("")}decConnector(t){if(this.#t[t]&&!["IN","OUT","NOT"].includes(this.#t[t].type)&&this.#t[t].from.length>2){var e=this.#t[t].from.indexOf("");-1!==e?this.#t[t].from.splice(e,1):this.#t[t].from.pop()}}addConnection(t,e,s){this.isConnectionValid(t,e)&&0<=s&&s<this.#t[e].from.length&&(this.#t[e].from[s]=t)}isConnectionValid(t,e){return!(t===e||!this.#t[t]||!this.#t[e])&&("IN"===this.#t[t].type?"IN"!==this.#t[e].type:"OUT"!==this.#t[t].type&&("IN"!==this.#t[e].type&&("OUT"===this.#t[e].type||!this.#m(t,e))))}#m(t,e){var s=Object.keys(this.#t).filter((t=>this.#i.includes(this.#t[t].type)&&this.#t[t].from.includes(e)));return s.includes(t)||s.reduce(((e,s)=>e||this.#m(t,s)),!1)}removeConnection(t,e){this.#t[t]&&this.#t[t].from&&0<=e&&e<this.#t[t].from.length&&(this.#t[t].from[e]="")}remove(t){this.#t[t]&&(delete this.#t[t],Object.keys(this.#t).filter((t=>"IN"!==this.#t[t].type)).forEach((e=>this.#t[e].from=this.#t[e].from.map((e=>e===t?"":e)))))}clear(){this.#t={}}getType(t){return this.#t[t]?this.#t[t].type:""}getFrom(t){return this.#t[t]&&"IN"!==this.#t[t].type?this.#t[t].from.slice():[]}isNameValid(t){return"string"==typeof t&&/^[a-z]+[a-z0-9_]*$/i.test(t)&&!this.#s.includes(t.toUpperCase())}isNameAlreadyUsed(t){return!!this.#t[t]}addBlackListWord(t){t&&this.#s.push(t.toUpperCase())}}class LogicalCircuitUI{#b;#y=new LogicalCircuitCore;#O={};#g={width:800,height:600,font:"24px sans-serif",lineWidth:2,strokeStyle:"black",fillStyle:"black",cursor:"default",bezierConnector:!1,showOperatorType:!1,interactive:!1};#I={index:0,array:[{json:"{}",jsonUI:"{}"}]};#N=[];#x=[];#v;#S;constructor(t,e){this.#b="LogicalCircuitUI_Container_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random());try{e.width}catch(t){e={}}this.#g.width=isNaN(e.width)||e.width<0?this.#g.width:e.width,this.#g.height=isNaN(e.height)||e.height<0?this.#g.height:e.height,t.classList.add("LogicalCircuitUI_Container"),t.classList.add(this.#b),t.style.width=this.#g.width+2+"px",this.#S=new LogicalCircuitToolbar(t,this.#b,this.#y,this.#O,this.#g,this.#I,this.#N,this.#x),this.#v=new LogicalCircuitCanvas(t,this.#b,this.#y,this.#O,this.#g,this.#I,this.#N,this.#x),this.#S.setCanvas(this.#v),this.#v.setToolbar(this.#S),this.setBezierConnector(e.bezierConnector),this.setShowOperatorType(e.showOperatorType),this.setInteractive(e.interactive)}setJSONs(t,e){this.#I.index=0,this.#I.array=[{json:JSON.stringify(t),jsonUI:JSON.stringify(e)}],this.#y.setJSON(t),Object.keys(this.#O).forEach((t=>delete this.#O[t])),Object.assign(this.#O,e),this.#S.setJSONUI(),this.#v.setJSONUI(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}getJSON(){return this.#y.getJSON()}getJSONUI(){return JSON.parse(JSON.stringify(this.#O))}setSimplifier(t){this.#y.setSimplifier(t),this.#S.setSimplifierVisible(!!t)}setReorganizer(t){this.#S.setReorganizer(t)}computeExpressions(t){return this.#y.computeExpressions(t)}computeExpression(t,e){return this.#y.computeExpression(t,e)}getJavaScriptExpressions(){return this.#y.getJavaScriptExpressions()}getJavaScriptExpression(t){return this.#y.getJavaScriptExpression(t)}isValid(){return this.#y.isValid()}setBezierConnector(t){this.#v.setBezierConnector(!!t)}setShowOperatorType(t){this.#v.setShowOperatorType(!!t)}setInteractive(t){this.#v.setInteractive(!!t)}addOnChangeListener(t){this.#N.push(t)}addOnChangeUIListener(t){this.#x.push(t)}addBlackListWord(t){this.#y.addBlackListWord(t)}}class LogicalCircuitToolbar{#b;#y;#O;#g;#I;#N=[];#x=[];#v;#j;#U={top:15,left:15};constructor(t,e,s,i,o,n,h,r){this.#b=e,this.#y=s,this.#O=i,this.#g=o,this.#I=n,this.#N=h,this.#x=r;var a=document.createElement("div");a.classList.add("LogicalCircuitUI_Toolbar"),a.style.width=this.#g.width+2+"px",t.append(a),this.#C(a,"â†¶",null,"UNDO",null,(()=>this.#T()),null,null,"small",!0,!0),this.#C(a,"â†·",null,"REDO",null,(()=>this.#P()),null,null,"small",!0,!0),this.#C(a,"ðŸ—‘",null,"CLEAR",null,(()=>this.#E()),null,"Divide_On_Right","small",!0,!0),this.#w(a),this.#C(a,"OR",null,null,null,(()=>this.#f("OR")),(()=>this.#f("NOR")),null,"medium",!1,!0),this.#C(a,"AND",null,null,null,(()=>this.#f("AND")),(()=>this.#f("NAND")),null,"medium",!1,!0),this.#C(a,"XOR",null,null,null,(()=>this.#f("XOR")),(()=>this.#f("NXOR")),null,"medium",!1,!0),this.#C(a,"NOT",null,null,null,(()=>this.#f("NOT")),null,"Divide_On_Right","medium",!1,!0),this.#C(a,"SIMPLIFY","REORGANIZE",null,null,(()=>this.#k()),(()=>this.#M()),null,"large",!0,!1)}#C(t,e,s,i,o,n,h,r,a,c,l){var d=document.createElement("div");if(d.classList.add("LogicalCircuitUI_Toolbar_ButtonContainer"),r&&d.classList.add(r),t.append(d),n&&(this.#L(d,e,i,a,c,l).onclick=t=>n()),h){var u=s||(e?"N"+e:null),f=o||(i?"N"+i:null);this.#L(d,u,f,a,c,l).onclick=t=>h()}}#w(t){var e=document.createElement("div");e.classList.add("LogicalCircuitUI_Toolbar_TextContainer"),e.classList.add("Divide_On_Right"),t.append(e);var s=document.createElement("input");s.type="text",s.classList.add("IN-OUT"),s.oninput=t=>{var e=!this.#y.isNameValid(s.value)||this.#y.isNameAlreadyUsed(s.value);i.disabled=e,o.disabled=e},e.append(s);var i=this.#L(e,"IN",null,"medium",!0,!0),o=this.#L(e,"OUT",null,"medium",!0,!0);i.onclick=t=>this.#R(s.value),o.onclick=t=>this.#A(s.value)}#L(t,e,s,i,o,n){var h=document.createElement("button");return h.textContent=e,s&&(h.title=s),h.classList.add(s?s.replace(" ","-"):e.replace(" ","-")),h.classList.add(i),h.disabled=o,h.style.visibility=n?"visible":"hidden",t.append(h),h}#T(){this.#I.index--,this.#y.setJSON(JSON.parse(this.#I.array[this.#I.index].json)),Object.keys(this.#O).forEach((t=>delete this.#O[t])),Object.assign(this.#O,JSON.parse(this.#I.array[this.#I.index].jsonUI)),this.setJSONUI(),this.#v.setJSONUI(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}#P(){this.#I.index++,this.#y.setJSON(JSON.parse(this.#I.array[this.#I.index].json)),Object.keys(this.#O).forEach((t=>delete this.#O[t])),Object.assign(this.#O,JSON.parse(this.#I.array[this.#I.index].jsonUI)),this.setJSONUI(),this.#v.setJSONUI(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}#E(){confirm("Do you really want to clear the current logical circuit?")&&(this.#I.index=0,this.#I.array=[{json:"{}",jsonUI:"{}"}],this.#y.clear(),Object.keys(this.#O).forEach((t=>delete this.#O[t])),this.setJSONUI(),this.#v.setJSONUI(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t())))}#R(t){this.#y.addInput(t),this.#D(t),this.#K(),this.setJSONUI(),this.#v.setInteractiveValue(t,!1),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}#A(t){this.#y.addOutput(t),this.#D(t),this.#K(),this.setJSONUI(),this.#v.draw(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}#f(t){var e=this.#y["add"+t]();this.#D(e),this.#K(),this.setJSONUI(),this.#v.draw(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}#D(t){this.#O[t]={top:this.#U.top,left:this.#U.left}}#k(){if(confirm("Do you really want to simplify the current logical circuit?")&&this.#y.simplify()){var t=this.#y.getJSON();Object.keys(this.#O).forEach((t=>delete this.#O[t])),Object.keys(t).filter((t=>"IN"===this.#y.getType(t))).forEach(((t,e,s)=>this.#v.assignPosition(t,e,s,this.#U.left))),Object.keys(t).filter((t=>"NOT"===this.#y.getType(t))).forEach(((t,e,s)=>this.#v.assignPosition(t,e,s,this.#g.width/5))),Object.keys(t).filter((t=>"AND"===this.#y.getType(t))).forEach(((t,e,s)=>this.#v.assignPosition(t,e,s,2*this.#g.width/5))),Object.keys(t).filter((t=>"OR"===this.#y.getType(t))).forEach(((t,e,s)=>this.#v.assignPosition(t,e,s,3*this.#g.width/5))),Object.keys(t).filter((t=>"OUT"===this.#y.getType(t))).forEach(((t,e,s)=>this.#v.assignPosition(t,e,s,4*this.#g.width/5)));try{this.#v.draw();var e=[];Object.keys(this.#O).filter((t=>"IN"!==this.#y.getType(t))).forEach((t=>this.#y.getFrom(t).forEach((s=>e.push({from:s,to:t})))));var s=this.#j(this.#v.getSymbolSize(),e,this.#g.width,this.#g.height);Object.assign(this.#O,s),this.#v.draw()}catch(t){}this.#K(),this.resetButtons(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}}#M(){if(confirm("Do you really want to reorganize the current logical circuit?"))try{var t=[];Object.keys(this.#O).filter((t=>"IN"!==this.#y.getType(t))).forEach((e=>this.#y.getFrom(e).forEach((s=>t.push({from:s,to:e})))));var e=this.#j(this.#v.getSymbolSize(),t,this.#g.width,this.#g.height);Object.keys(this.#O).forEach((t=>delete this.#O[t])),Object.assign(this.#O,e),this.#K(),this.resetButtons(),this.#v.draw(),this.#x.forEach((t=>t()))}catch(t){}}#K(){this.#I.array.splice(this.#I.index+1),this.#I.index++,this.#I.array.push({json:JSON.stringify(this.#y.getJSON()),jsonUI:JSON.stringify(this.#O)})}setCanvas(t){this.#v=t}setJSONUI(){this.resetButtons(),this.#z()}resetButtons(){var t=this.#y.isEmpty()||!this.#y.isValid();document.querySelector("."+this.#b+" button.UNDO").disabled=0===this.#I.index,document.querySelector("."+this.#b+" button.REDO").disabled=this.#I.index===this.#I.array.length-1,document.querySelector("."+this.#b+" button.CLEAR").disabled=this.#y.isEmpty(),document.querySelector("."+this.#b+" button.SIMPLIFY").disabled=t,document.querySelector("."+this.#b+" button.REORGANIZE").disabled=t}#z(){document.querySelector("."+this.#b+" input.IN-OUT").value="",document.querySelector("."+this.#b+" button.IN").disabled=!0,document.querySelector("."+this.#b+" button.OUT").disabled=!0}setSimplifierVisible(t){document.querySelector("."+this.#b+" .SIMPLIFY").style.visibility=t?"visible":"hidden"}setReorganizer(t){this.#j=t,document.querySelector("."+this.#b+" .REORGANIZE").style.visibility=t?"visible":"hidden"}}class LogicalCircuitCanvas{#b;#y;#O;#g;#I;#N=[];#x=[];#S;#v;#X;#J={selected:!1};#B={};#F={};#W={};#q={};#V={};#H={};#Y={};#_;#G={font:"48px sans-serif",text:"ðŸ—‘",strokeStyle:"red",left:35,top:20,lineWidth:80,radius1:40,radius2:120,gradients:[{pos:0,color:"rgba(0,0,0,0)"},{pos:.5,color:"rgba(0,0,0,0)"},{pos:1,color:"rgba(0,0,0,0.3)"}]};#Z={gap:20,height:40,ONStyle:"green",OFFStyle:"gray",circleStyle:"white"};#$={radiusLeft:20,lineWidth:30,oneHeight:20,xorGap:12,notRadius:7,font:"9px sans-serif"};#Q={pressed:!1,name:"",index:-1,referenceName:"",event:null,canDoStrokeStyle:"green",cannotDoStrokeStyle:"orange",lineWidth:3,radius:5};#tt={grab:"grab",pointer:"pointer",notAllowed:"not-allowed",grabbing:"grabbing"};#et={name:"",index:-1,referencePath:"",referenceName:"",lineWidth:3,strokeStyle:"green"};#st={pressed:!1,name:"",offsetLeft:0,offsetTop:0};#it={selected:!1,name:"",direction:"",font:"14px sans-serif",up:"-",down:"+",max:6,canDoFillStyle:"white",cannotDoFillStyle:"gray"};constructor(t,e,s,i,o,n,h,r){this.#b=e,this.#y=s,this.#O=i,this.#g=o,this.#I=n,this.#N=h,this.#x=r,this.#v=document.createElement("canvas"),this.#v.classList.add("LogicalCircuitUI_Canvas"),this.#v.width=this.#g.width,this.#v.height=this.#g.height,this.#v.onmousemove=t=>this.#ot(t),this.#v.onmousedown=t=>this.#nt(t),this.#v.onmouseup=t=>this.#ht(t),t.append(this.#v),this.#X=this.#v.getContext("2d"),this.#X.font=this.#g.font,this.#X.textBaseline="middle",this.#X.lineWidth=this.#g.lineWidth,this.#X.lineJoin="round",this.draw()}setToolbar(t){this.#S=t}setJSONUI(){this.setInteractive(this.#g.interactive)}setBezierConnector(t){this.#g.bezierConnector=t,this.draw()}setShowOperatorType(t){this.#g.showOperatorType=t,this.draw()}setInteractive(t){this.#g.interactive=!!t,this.#J.selected=!1,this.#B={},t&&Object.keys(this.#O).filter((t=>"IN"===this.#y.getType(t))).forEach((t=>this.#B[t]=!1)),this.draw()}setInteractiveValue(t,e){this.#g.interactive&&(this.#B[t]=e),this.draw()}getSymbolSize(){return Object.keys(this.#H).filter((t=>!this.#O[t])).forEach((t=>delete this.#H[t])),JSON.parse(JSON.stringify(this.#H))}assignPosition(t,e,s,i){this.#O[t]={top:(e+1)*this.#v.height/(s.length+1)-this.#Z.height,left:i}}draw(){this.#v.style.cursor=this.#g.cursor,this.#X.clearRect(0,0,this.#v.width,this.#v.height),this.#rt(),Object.keys(this.#O).forEach((t=>{var e=this.#y.getType(t);switch(e){case"IN":this.#at(t,"exit");break;case"OUT":this.#at(t,"0");break;default:this.#ct(t,e);break}})),Object.keys(this.#O).forEach((t=>{switch(this.#y.getType(t)){case"IN":break;case"OUT":default:this.#y.getFrom(t).forEach(((e,s)=>this.#lt(e,t,s)));break}})),this.#dt(),this.#ut()}#rt(){this.#X.font=this.#G.font,this.#X.fillText(this.#G.text,this.#v.width-this.#G.left,this.#v.height-this.#G.top),this.#X.font=this.#g.font;var t=this.#X.createRadialGradient(this.#v.width,this.#v.height,this.#G.radius1,this.#v.width,this.#v.height,this.#G.radius2);this.#G.gradients.forEach((e=>t.addColorStop(e.pos,e.color))),this.#X.lineWidth=this.#G.lineWidth,this.#X.strokeStyle=t,this.#X.beginPath(),this.#X.arc(this.#v.width,this.#v.height,this.#G.lineWidth,0,2*Math.PI),this.#X.stroke(),this.#X.lineWidth=this.#g.lineWidth,this.#X.strokeStyle=this.#g.strokeStyle}#at(t,e){var s=this.#X.measureText(t).width+this.#Z.gap+(this.#g.interactive?this.#Z.gap:0),i=this.#O[t].top+this.#Z.height/2;if(this.#q[t+"*"+e]={left:this.#O[t].left+("exit"===e?s+this.#Q.radius:-this.#Q.radius),top:i},this.#ft(t+"*"+e),this.#H[t]={width:s,height:this.#Z.height},this.#V[t]=new Path2D,this.#V[t].rect(this.#O[t].left,this.#O[t].top,s,this.#Z.height),this.#X.stroke(this.#V[t]),this.#g.interactive){var o;o="exit"===e?this.#B[t]?this.#Z.ONStyle:this.#Z.OFFStyle:this.#y.isValid()?this.#y.computeExpression(t,this.#B)?this.#Z.ONStyle:this.#Z.OFFStyle:this.#Z.circleStyle;var n=this.#Z.gap/2-2,h=o===this.#Z.ONStyle?this.#O[t].top+2+n+2:this.#O[t].top+this.#Z.height-2-n-2,r=new Path2D;r.roundRect(this.#O[t].left+s-this.#Z.gap-2,this.#O[t].top+2,this.#Z.gap,this.#Z.height-4,this.#Z.gap/2),"exit"===e&&(this.#F[t]=r),this.#X.fillStyle=o,this.#X.fill(r),this.#X.fillStyle=this.#Z.circleStyle,this.#X.beginPath(),this.#X.arc(this.#O[t].left+s-this.#Z.gap/2-2,h,n,0,2*Math.PI),this.#X.fill(),this.#X.fillStyle=this.#g.strokeStyle}this.#X.fillText(t,this.#O[t].left+this.#Z.gap/2,this.#q[t+"*"+e].top)}#ct(t,e){this.#V[t]=new Path2D;var s=this.#y.getFrom(t),i=this.#$.oneHeight*s.length/2,o=this.#O[t].left+this.#$.lineWidth+("NOT"===e?this.#$.radiusLeft:0),n=this.#O[t].top+this.#$.oneHeight*("NOT"===e?2:s.length),h=this.#O[t].top+("NOT"===e?this.#$.oneHeight:i);this.#pt(t,e,o,h),this.#mt(t,e,s,h,i),this.#bt(t,e,s,o,h),this.#yt(t,e,o,n,h,i),this.#Ot(t,e)}#pt(t,e,s,i){switch(e){case"OR":case"AND":case"XOR":this.#q[t+"*exit"]={left:s+this.#$.radiusLeft+this.#Q.radius,top:i};break;case"NOR":case"NAND":case"NXOR":this.#q[t+"*exit"]={left:s+this.#$.radiusLeft+2*this.#$.notRadius+this.#Q.radius,top:i};break;case"NOT":this.#q[t+"*exit"]={left:s+2*this.#$.notRadius+this.#Q.radius,top:i};break}this.#ft(t+"*exit")}#mt(t,e,s,i,o){for(var n=Math.PI/(s.length+1),h=0;h<s.length;h++){switch(e){case"OR":case"NOR":var r=n*(h+1)-Math.PI/2;this.#q[t+"*"+h]={left:this.#O[t].left+(this.#$.radiusLeft-this.#Q.radius)*Math.cos(r),top:i+(o-this.#Q.radius)*Math.sin(r)};break;case"AND":case"NAND":this.#q[t+"*"+h]={left:this.#O[t].left-this.#Q.radius,top:this.#O[t].top+this.#$.oneHeight/2+this.#$.oneHeight*h};break;case"XOR":case"NXOR":r=n*(h+1)-Math.PI/2;this.#q[t+"*"+h]={left:this.#O[t].left+(this.#$.radiusLeft-this.#Q.radius)*Math.cos(r)-this.#$.xorGap,top:i+(o-this.#Q.radius)*Math.sin(r)};break;case"NOT":this.#q[t+"*"+h]={left:this.#O[t].left-this.#Q.radius,top:i};break}this.#ft(t+"*"+h)}}#bt(t,e,s,i,o){switch(e){case"OR":case"AND":case"XOR":this.#H[t]={width:this.#$.lineWidth+this.#$.radiusLeft,height:this.#$.oneHeight*s.length};break;case"NOR":case"NAND":case"NXOR":(n=new Path2D).arc(i+this.#$.radiusLeft+this.#$.notRadius,o,this.#$.notRadius,0,2*Math.PI),this.#V[t].addPath(n),this.#H[t]={width:this.#$.lineWidth+this.#$.radiusLeft+2*this.#$.notRadius,height:this.#$.oneHeight*s.length};break;case"NOT":var n;(n=new Path2D).arc(i+this.#$.notRadius,o,this.#$.notRadius,0,2*Math.PI),this.#V[t].addPath(n),this.#H[t]={width:this.#$.lineWidth+this.#$.radiusLeft+2*this.#$.notRadius,height:2*this.#$.oneHeight};break}}#yt(t,e,s,i,o,n){switch("NOT"!==e&&(this.#V[t].moveTo(s,i),this.#V[t].lineTo(this.#O[t].left,i)),e){case"OR":case"NOR":this.#V[t].ellipse(this.#O[t].left,o,this.#$.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#V[t].lineTo(s,this.#O[t].top),this.#V[t].quadraticCurveTo(s+3*this.#$.radiusLeft/5,this.#O[t].top,s+this.#$.radiusLeft,o),this.#V[t].quadraticCurveTo(s+3*this.#$.radiusLeft/5,i,s,i);break;case"AND":case"NAND":this.#V[t].lineTo(this.#O[t].left,this.#O[t].top),this.#V[t].lineTo(s,this.#O[t].top),this.#V[t].ellipse(s,o,this.#$.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":this.#V[t].ellipse(this.#O[t].left,o,this.#$.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#V[t].lineTo(s,this.#O[t].top),this.#V[t].ellipse(s,o,this.#$.radiusLeft,n,0,-Math.PI/2,Math.PI/2);var h=new Path2D;h.ellipse(this.#O[t].left-this.#$.xorGap,o,this.#$.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#V[t].addPath(h);break;case"NOT":this.#V[t].moveTo(this.#O[t].left,this.#O[t].top),this.#V[t].lineTo(s,o),this.#V[t].lineTo(this.#O[t].left,i),this.#V[t].closePath();break}this.#X.stroke(this.#V[t])}#Ot(t,e){if(this.#g.showOperatorType){var s;switch(this.#X.font=this.#$.font,e){case"OR":case"XOR":s=this.#$.radiusLeft+(this.#H[t].width-this.#$.radiusLeft-this.#X.measureText(e).width)/2;break;case"AND":s=(this.#H[t].width-this.#X.measureText(e).width)/2;break;case"NOR":case"NXOR":s=this.#$.radiusLeft+(this.#H[t].width-this.#$.radiusLeft-this.#X.measureText(e).width)/2-this.#$.notRadius;break;case"NAND":s=(this.#H[t].width-this.#X.measureText(e).width)/2-this.#$.notRadius;break;case"NOT":s=(this.#H[t].width-this.#X.measureText(e).width)/4;break}this.#X.fillText(e,this.#O[t].left+s,this.#O[t].top+this.#H[t].height/2),this.#X.font=this.#g.font}}#ft(t){this.#W[t]=new Path2D,this.#W[t].moveTo(this.#q[t].left,this.#q[t].top-this.#Q.radius),this.#W[t].lineTo(this.#q[t].left+this.#Q.radius,this.#q[t].top),this.#W[t].lineTo(this.#q[t].left,this.#q[t].top+this.#Q.radius),this.#W[t].lineTo(this.#q[t].left-this.#Q.radius,this.#q[t].top),this.#W[t].closePath(),this.#X.stroke(this.#W[t])}#lt(t,e,s){if(t){if(this.#Y[e+"*"+s]=new Path2D,this.#Y[e+"*"+s].moveTo(this.#q[t+"*exit"].left,this.#q[t+"*exit"].top),this.#g.bezierConnector){var i={left:this.#q[t+"*exit"].left+(this.#q[e+"*"+s].left-this.#q[t+"*exit"].left)/2,top:this.#q[t+"*exit"].top},o={left:i.left,top:this.#q[e+"*"+s].top};this.#Y[e+"*"+s].bezierCurveTo(i.left,i.top,o.left,o.top,this.#q[e+"*"+s].left,this.#q[e+"*"+s].top)}else this.#Y[e+"*"+s].lineTo(this.#q[e+"*"+s].left,this.#q[e+"*"+s].top);this.#X.stroke(this.#Y[e+"*"+s])}}#dt(){if(this.#et.name){var t=this.#y.getType(this.#et.name);"symbolPath"!==this.#et.referencePath||(this.#g.interactive&&"IN"===t?(this.#J.selected=this.#X.isPointInPath(this.#F[this.#et.name],this.#_.offsetX,this.#_.offsetY),this.#v.style.cursor=this.#J.selected?this.#tt.pointer:this.#tt.grab):["IN","OUT","NOT"].includes(t)?this.#v.style.cursor=this.#tt.grab:this.#gt()),this.#It()}else;}#gt(){var t=this.#O[this.#et.name].left+3*this.#H[this.#et.name].width/5;switch(this.#y.getType(this.#et.name)){case"OR":case"AND":case"XOR":break;case"NOR":case"NAND":case"NXOR":t-=this.#$.notRadius;break}var e=this.#y.getFrom(this.#et.name).length,s=this.#O[this.#et.name].top+this.#H[this.#et.name].height/4,i=this.#O[this.#et.name].top+3*this.#H[this.#et.name].height/4;this.#X.font=this.#it.font;var o=this.#X.measureText(this.#it.up).width,n=this.#X.measureText(this.#it.down).width,h=Math.max(o,n),r=new Path2D,a=new Path2D;this.#X.fillStyle=e>2?this.#it.canDoFillStyle:this.#it.cannotDoFillStyle,a.rect(t-2,this.#O[this.#et.name].top+3,h+4,this.#H[this.#et.name].height/2-3),r.addPath(a),this.#X.fill(a),this.#X.stroke(a),a=new Path2D,this.#X.fillStyle=e<this.#it.max?this.#it.canDoFillStyle:this.#it.cannotDoFillStyle,a.rect(t-2,this.#O[this.#et.name].top+this.#H[this.#et.name].height/2,h+4,this.#H[this.#et.name].height/2-3),r.addPath(a),this.#X.fill(a),this.#X.stroke(a),this.#X.fillStyle=this.#g.fillStyle,this.#X.fillText(this.#it.up,t+(h-o)/2,s),this.#X.fillText(this.#it.down,t+(h-n)/2,i),this.#X.font=this.#g.font,this.#it.selected=this.#X.isPointInPath(r,this.#_.offsetX,this.#_.offsetY),this.#it.name=this.#et.name,this.#it.direction=this.#_.offsetY<this.#O[this.#et.name].top+this.#H[this.#et.name].height/2?"UP":"DOWN",this.#it.selected?"UP"===this.#it.direction&&e>2||"DOWN"===this.#it.direction&&e<this.#it.max?this.#v.style.cursor=this.#tt.pointer:this.#v.style.cursor=this.#tt.notAllowed:this.#v.style.cursor=this.#tt.grab}#It(){this.#X.lineWidth=this.#et.lineWidth,this.#st.pressed?(this.#v.style.cursor=this.#tt.grabbing,this.#X.strokeStyle=this.#Nt(this.#v.width,this.#v.height,this.#G.lineWidth,this.#O[this.#et.name].left,this.#O[this.#et.name].top,this.#H[this.#et.name].width,this.#H[this.#et.name].height)?this.#G.strokeStyle:this.#et.strokeStyle):this.#X.strokeStyle="connectorPath"===this.#et.referencePath?this.#G.strokeStyle:this.#et.strokeStyle,this.#X.stroke(this.#xt(this.#et.referencePath,this.#et.referenceName)),this.#X.lineWidth=this.#g.lineWidth,this.#X.strokeStyle=this.#g.strokeStyle}#Nt(t,e,s,i,o,n,h){var r=t,a=e;t<i?r=i:t>i+n&&(r=i+n),e<o?a=o:e>o+h&&(a=o+h);var c=t-r,l=e-a;return Math.sqrt(c*c+l*l)<=s}#xt(t,e){switch(t){case"symbolPath":return this.#V[e];case"knobPath":return this.#W[e];case"connectorPath":return this.#Y[e]}}#ut(){if(this.#Q.pressed){if(this.#X.beginPath(),this.#X.moveTo(this.#Q.event.offsetX,this.#Q.event.offsetY),this.#g.bezierConnector){var t={left:this.#Q.event.offsetX+(this.#_.offsetX-this.#Q.event.offsetX)/2,top:this.#Q.event.offsetY},e={left:t.left,top:this.#_.offsetY};this.#X.bezierCurveTo(t.left,t.top,e.left,e.top,this.#_.offsetX,this.#_.offsetY)}else this.#X.lineTo(this.#_.offsetX,this.#_.offsetY);this.#X.stroke(),this.#Q.name&&(this.#X.lineWidth=this.#Q.lineWidth,this.#X.strokeStyle=this.#vt(this.#et.name,this.#et.index,this.#Q.name,this.#Q.index)?this.#Q.canDoStrokeStyle:this.#Q.cannotDoStrokeStyle,this.#X.stroke(this.#W[this.#Q.referenceName]),this.#X.lineWidth=this.#g.lineWidth,this.#X.strokeStyle=this.#g.strokeStyle)}}#ot(t){this.#_=t;var e=Math.sqrt(Math.pow(t.offsetX-this.#v.width,2)+Math.pow(t.offsetY-this.#v.height,2));this.#v.setAttribute("title",e<this.#G.radius2?"To trash an element move and release it here":""),this.#st.pressed?(this.#O[this.#et.name].top=t.offsetY-this.#st.offsetTop,this.#O[this.#et.name].left=t.offsetX-this.#st.offsetLeft):this.#Q.pressed?this.#St(t):this.#jt(t),this.draw()}#St(t){this.#Q.name="",Object.keys(this.#O).forEach((e=>{switch(this.#y.getType(e)){case"IN":!this.#Q.name&&this.#X.isPointInPath(this.#W[e+"*exit"],t.offsetX,t.offsetY)&&(this.#Q.name=e,this.#Q.index=-1,this.#Q.referenceName=e+"*exit");break;case"OUT":this.#y.getFrom(e).forEach(((s,i)=>{!this.#Q.name&&this.#X.isPointInPath(this.#W[e+"*"+i],t.offsetX,t.offsetY)&&(this.#Q.name=e,this.#Q.index=i,this.#Q.referenceName=e+"*"+i)}));break;default:!this.#Q.name&&this.#X.isPointInPath(this.#W[e+"*exit"],t.offsetX,t.offsetY)&&(this.#Q.name=e,this.#Q.index=-1,this.#Q.referenceName=e+"*exit"),this.#y.getFrom(e).forEach(((s,i)=>{!this.#Q.name&&this.#X.isPointInPath(this.#W[e+"*"+i],t.offsetX,t.offsetY)&&(this.#Q.name=e,this.#Q.index=i,this.#Q.referenceName=e+"*"+i)}));break}}))}#jt(t){this.#et.name="",Object.keys(this.#O).forEach((e=>{switch(this.#y.getType(e)){case"IN":!this.#et.name&&this.#X.isPointInPath(this.#W[e+"*exit"],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=-1,this.#et.referencePath="knobPath",this.#et.referenceName=e+"*exit");break;case"OUT":!this.#et.name&&this.#X.isPointInPath(this.#W[e+"*0"],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=0,this.#et.referencePath="knobPath",this.#et.referenceName=e+"*0"),!this.#et.name&&this.#y.getFrom(e)[0]&&this.#X.isPointInStroke(this.#Y[e+"*0"],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=0,this.#et.referencePath="connectorPath",this.#et.referenceName=e+"*0");break;default:!this.#et.name&&this.#X.isPointInPath(this.#W[e+"*exit"],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=-1,this.#et.referencePath="knobPath",this.#et.referenceName=e+"*exit"),this.#y.getFrom(e).forEach(((s,i)=>{!this.#et.name&&this.#X.isPointInPath(this.#W[e+"*"+i],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=i,this.#et.referencePath="knobPath",this.#et.referenceName=e+"*"+i),!this.#et.name&&s&&this.#X.isPointInStroke(this.#Y[e+"*"+i],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.index=i,this.#et.referencePath="connectorPath",this.#et.referenceName=e+"*"+i)}));break}!this.#et.name&&this.#X.isPointInPath(this.#V[e],t.offsetX,t.offsetY)&&(this.#et.name=e,this.#et.referencePath="symbolPath",this.#et.referenceName=e)}))}#nt(t){if(this.#et.name)switch(this.#et.referencePath){case"knobPath":this.#Q.pressed=!0,this.#Q.event=t;break;case"symbolPath":if(this.#it.selected){var e=!1,s=this.#y.getFrom(this.#it.name).length;switch(this.#it.direction){case"UP":s>2&&(e=!0,this.#y.decConnector(this.#it.name),this.#O[this.#it.name].top+=this.#$.oneHeight/2);break;case"DOWN":s<this.#it.max&&(e=!0,this.#y.incConnector(this.#it.name),this.#O[this.#it.name].top-=this.#$.oneHeight/2);break}e&&(this.#K(),this.#S.resetButtons(),this.draw(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t())))}else this.#J.selected?(this.#B[this.#et.name]=!this.#B[this.#et.name],this.draw()):(this.#st.pressed=!0,this.#st.offsetLeft=t.offsetX-this.#O[this.#et.name].left,this.#st.offsetTop=t.offsetY-this.#O[this.#et.name].top,this.#v.style.cursor=this.#tt.grabbing);break;case"connectorPath":this.#y.removeConnection(this.#et.name,this.#et.index),this.#et.name="",this.#K(),this.#S.resetButtons(),this.draw(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()));break}}#ht(t){if(this.#et.name&&this.#st.pressed){var e=!1;this.#Nt(this.#v.width,this.#v.height,this.#G.lineWidth,this.#O[this.#et.name].left,this.#O[this.#et.name].top,this.#H[this.#et.name].width,this.#H[this.#et.name].height)&&(e=!0,this.#y.remove(this.#et.name),delete this.#O[this.#et.name],this.#et.name=""),this.#K(),this.#S.resetButtons(),this.draw(),e&&this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}else if(this.#Q.pressed&&this.#Q.name&&this.#vt(this.#et.name,this.#et.index,this.#Q.name,this.#Q.index)){var s=this.#y.getType(this.#et.name),i=this.#y.getType(this.#Q.name);"IN"===s?this.#y.addConnection(this.#et.name,this.#Q.name,this.#Q.index):"IN"===i?this.#y.addConnection(this.#Q.name,this.#et.name,this.#et.index):"OUT"===s?this.#y.addConnection(this.#Q.name,this.#et.name,0):"OUT"===i?this.#y.addConnection(this.#et.name,this.#Q.name,0):-1===this.#et.index?this.#y.addConnection(this.#et.name,this.#Q.name,this.#Q.index):-1===this.#Q.index&&this.#y.addConnection(this.#Q.name,this.#et.name,this.#et.index),this.#K(),this.#S.resetButtons(),this.draw(),this.#N.forEach((t=>t())),this.#x.forEach((t=>t()))}this.#Q.pressed=!1,this.#st.pressed=!1,this.#it.selected=!1}#K(){this.#I.array.splice(this.#I.index+1),this.#I.index++,this.#I.array.push({json:JSON.stringify(this.#y.getJSON()),jsonUI:JSON.stringify(this.#O)})}#vt(t,e,s,i){var o=this.#y.getType(t),n=this.#y.getType(s);return("IN"!==o||"IN"!==n)&&("IN"===o&&"OUT"===n?this.#y.isConnectionValid(t,s):"IN"===o?-1!==i&&this.#y.isConnectionValid(t,s):"OUT"===o&&"IN"===n?this.#y.isConnectionValid(s,t):("OUT"!==o||"OUT"!==n)&&("OUT"===o?-1===i&&this.#y.isConnectionValid(s,t):"IN"===n?-1!==e&&this.#y.isConnectionValid(s,t):"OUT"===n?-1===e&&this.#y.isConnectionValid(t,s):(-1!==e||-1!==i)&&((-1===e||-1===i)&&(-1===e?this.#y.isConnectionValid(t,s):-1===i&&this.#y.isConnectionValid(s,t)))))}}
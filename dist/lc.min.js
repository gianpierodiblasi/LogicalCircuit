class LogicalCircuit{#t={};#e=["OR","NOR","AND","NAND","XOR","NXOR","NOT","BREAK","CASE","CATCH","CLASS","CONST","CONTINUE","DEBUGGER","DEFAULT","DELETE","DO","ELSE","EXPORT","EXTENDS","FALSE","FINALLY","FOR","FUNCTION","IF","IMPORT","IN","INSTANCEOF","NEW","NULL","RETURN","SUPER","SWITCH","THIS","THROW","TRUE","TRY","TYPEOF","VAR","VOID","WHILE","WITH","LET","STATIC","YIELD","AWAIT","ENUM","IMPLEMENTS","INTERFACE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","ABSTRACT","BOOLEAN","BYTE","CHAR","DOUBLE","FINAL","FLOAT","GOTO","INT","LONG","NATIVE","SHORT","SYNCHRONIZED","THROWS","TRANSIENT","VOLATILE","ARGUMENTS","AS","ASYNC","EVAL","FROM","GET","OF","SET"];#s=["OR","NOR","AND","NAND","XOR","NXOR","NOT"];#i={OR:"||",AND:"&&",NOR:"||",NAND:"&&"};constructor(){}setJSON(t){this.#t=JSON.parse(JSON.stringify(t))}getJSON(){return JSON.parse(JSON.stringify(this.#t))}simplify(){if(this.isValid()){var t=Object.keys(this.#t).filter((t=>"IN"===this.#t[t].type)),e={},s=!0;return t.forEach((t=>e[t]={type:"IN"})),Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((i=>{var o=this.#o(i,t),n=this.#n(o),h=this.#h(o,n),a=this.#a(n,h);e[i]={type:"OUT",from:[this.#r(e,t,a)]},s&=this.#c(i,e,t)})),s&&(this.#t=e),!!s}return!1}#o(t,e){for(var s={},i=0;i<Math.pow(2,e.length);i++){var o={},n=i.toString(2).padStart(e.length,"0");e.forEach(((t,e)=>o[t]=!!parseInt(n[e]))),this.computeExpression(t,o)&&(s[""+i]=n)}return s}#n(t){var e={},s=!1;return Object.keys(t).forEach((i=>{var o=!1;Object.keys(t).forEach((n=>{for(var h=0,a=t[i],r=0;r<a.length;r++)a[r]!==t[n][r]&&(a=a.substring(0,r)+"-"+a.substring(r+1),h++);1===h&&(o=!0,s=!0,Object.keys(e).some((t=>e[t]===a))||(e[i+","+n]=a))})),o||(e[i]=t[i])})),s?this.#n(e):e}#h(t,e){var s={};return Object.keys(t).forEach((t=>s[t]=Object.keys(e).flatMap((t=>t.split(","))).filter((e=>e===t)).length)),s}#a(t,e){for(var s={},i=!0;i;)i=!1,Object.keys(e).filter((t=>1===e[t])).forEach((o=>{i=!0,delete e[o],Object.keys(t).filter((t=>t.split(",").includes(o))).forEach((e=>{s[e]=t[e],delete t[e]}))}));return s}#r(t,e,s){var i=this.#l();return t[i]={type:"OR",from:[]},Object.keys(s).forEach((o=>{var n=s[o].split("");if(1===n.filter((t=>"-"!==t)).length)this.#d(t,i,e,n);else{var h=this.#l();t[h]={type:"AND",from:[]},this.#d(t,h,e,n),t[i].from.push(h)}})),i}#d(t,e,s,i){for(var o=0;o<i.length;o++)switch(i[o]){case"0":var n=this.#l();t[n]={type:"NOT",from:[s[o]]},t[e].from.push(n);break;case"1":t[e].from.push(s[o]);break;case"-":break}}#c(t,e,s){for(var i=this.#t,o=!0,n=0;n<Math.pow(2,s.length);n++){var h={},a=n.toString(2).padStart(s.length,"0");s.forEach(((t,e)=>h[t]=!!parseInt(a[e])));var r=this.computeExpression(t,h);this.#t=e;var c=this.computeExpression(t,h);this.#t=i,o&=r===c}return!!o}computeExpressions(t){var e={};return this.isValid()&&Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((s=>e[s]=this.computeExpression(s,t))),e}computeExpression(name,parameters){var result;if(this.isValid()){var toEval="",expressions=this.getJavaScriptExpression(name);for(var property in expressions.xor&&(toEval="var xor = "+expressions.xor+";\n"),parameters)toEval+="var "+property+" = "+parameters[property]+";\n";toEval+="result = "+expressions[name]+";",eval(toEval)}return result}getJavaScriptExpressions(){var t={};return this.isValid()&&(Object.keys(this.#t).some((t=>["XOR","NXOR"].includes(this.#t[t].type)))&&(t.xor="(...a)=>a.filter(e=>e).length==1"),Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t[e]=this.#u(this.#t[e].from[0],!1)))),t}getJavaScriptExpression(t){var e={};return this.isValid()&&this.#t[t]&&"OUT"===this.#t[t].type&&(Object.keys(this.#t).some((t=>["XOR","NXOR"].includes(this.#t[t].type)))&&(e.xor="(...a)=>a.filter(e=>e).length==1"),e[t]=this.#u(this.#t[t].from[0],!1)),e}#u(t,e){if("IN"===this.#t[t].type)return t;if("NOT"===this.#t[t].type)return"!"+this.#u(this.#t[t].from[0],!0);var s=[];switch(this.#t[t].type){case"OR":case"AND":case"NOR":case"NAND":this.#t[t].from.forEach((t=>s.push(this.#u(t,!0))));break;case"XOR":case"NXOR":this.#t[t].from.forEach((t=>s.push(this.#u(t,!1))));break}switch(this.#t[t].type){case"OR":case"AND":return(e?"(":"")+s.join(this.#i[this.#t[t].type])+(e?")":"");case"NOR":case"NAND":return"!("+s.join(this.#i[this.#t[t].type])+")";case"XOR":return"xor("+s.join(",")+")";case"NXOR":return"!xor("+s.join(",")+")"}}isValid(){var t=!0;return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t&=this.#f(e))),!!t}#f(t){var e=!0;return this.#t[t].from.forEach((t=>{(e&=!!t)&&"IN"!==this.#t[t].type&&(e&=!!this.#f(t))})),!!e}addInput(t){return this.#p(t,{type:"IN"})}addOutput(t){return this.#p(t,{type:"OUT",from:[""]})}addOR(){return this.#m("OR",["",""])}addNOR(){return this.#m("NOR",["",""])}addAND(){return this.#m("AND",["",""])}addNAND(){return this.#m("NAND",["",""])}addXOR(){return this.#m("XOR",["",""])}addNXOR(){return this.#m("NXOR",["",""])}addNOT(){return this.#m("NOT",[""])}#m(t,e){var s=this.#l();return this.#p(s,{type:t,from:e}),s}#p(t,e){return!(!this.isNameValid(t)||this.isNameAlreadyUsed(t))&&(this.#t[t]=e,!0)}#l(){return"LogicalCircuit_Operator_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random())}incConnector(t){this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.push("")}decConnector(t){if(this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.length>2){var e=this.#t[t].from.indexOf("");-1!==e?this.#t[t].from.splice(e,1):this.#t[t].from.pop()}}addConnection(t,e,s){this.isConnectionValid(t,e)&&0<=s&&s<this.#t[e].from.length&&(this.#t[e].from[s]=t)}isConnectionValid(t,e){return!(t===e||!this.#t[t]||!this.#t[e])&&("IN"===this.#t[t].type?"IN"!==this.#t[e].type:"OUT"!==this.#t[t].type&&("IN"!==this.#t[e].type&&("OUT"===this.#t[e].type||!this.#b(t,e))))}#b(t,e){var s=Object.keys(this.#t).filter((t=>this.#s.includes(this.#t[t].type)&&this.#t[t].from.includes(e)));if(s.includes(t))return!0;var i=!1;return s.forEach((e=>i|=this.#b(t,e))),i}removeConnection(t,e){this.#t[t]&&0<=e&&e<this.#t[t].from.length&&(this.#t[t].from[e]="")}remove(t){if(this.#t[t])for(var e in delete this.#t[t],this.#t)switch(this.#t[e].type){case"IN":break;case"OUT":default:this.#t[e].from=this.#t[e].from.map((e=>e===t?"":e));break}}clear(){this.#t={}}getType(t){return this.#t[t]?this.#t[t].type:""}getFrom(t){if(!this.#t[t])return[];switch(this.#t[t].type){case"IN":return[];case"OUT":default:return this.#t[t].from.slice()}}isNameValid(t){return"string"==typeof t&&(/^[a-z]+[a-z0-9_]*$/i.test(t)&&!this.#e.includes(t.toUpperCase()))}isNameAlreadyUsed(t){return!!this.#t[t]}addBlackListWord(t){t&&this.#e.push(t.toUpperCase())}}class LogicalCircuitUI{#g=new LogicalCircuit;#y={};#x={};#O;#C;#v;#N=[];#I=[];#P={};#w={};#T={};#k={};#j={};#E={};#S;#M={width:800,height:600,font:"24px sans-serif",lineWidth:2,strokeStyle:"black",cursor:"default",bezierConnector:!1,showOperatorType:!1,interactive:!1};#U={grab:"grab",pointer:"pointer",notAllowed:"not-allowed",grabbing:"grabbing"};#L={top:15,left:15};#R={font:"48px sans-serif",text:"ðŸ—‘",strokeStyle:"red",left:35,top:20,lineWidth:80,radius1:40,radius2:120,gradients:[{pos:0,color:"rgba(0,0,0,0)"},{pos:.5,color:"rgba(0,0,0,0)"},{pos:1,color:"rgba(0,0,0,0.3)"}]};#A={gap:20,height:40,ONStyle:"green",OFFStyle:"gray",circleStyle:"white"};#K={radiusLeft:20,lineWidth:30,oneHeight:20,xorGap:12,notRadius:7,font:"9px sans-serif"};#D={name:"",index:-1,referencePath:"",referenceName:"",lineWidth:3,strokeStyle:"green"};#X={pressed:!1,name:"",index:-1,referenceName:"",event:null,canDoStrokeStyle:"green",cannotDoStrokeStyle:"orange",lineWidth:3,radius:5};#W={pressed:!1,name:"",offsetLeft:0,offsetTop:0};#z={selected:!1,name:"",direction:"",font:"14px sans-serif",up:"-",down:"+",max:6,canDoStrokeStyle:"white",cannotDoStrokeStyle:"gray"};#F={selected:!1};constructor(t,e){try{e.width}catch(t){e={}}e.width=isNaN(e.width)||e.width<0?this.#M.width:e.width,e.height=isNaN(e.height)||e.height<0?this.#M.height:e.height,this.#O="LogicalCircuitUI_Container_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),t.classList.add("LogicalCircuitUI_Container"),t.classList.add(this.#O),t.style.width=e.width+2+"px";var s=document.createElement("div");s.classList.add("LogicalCircuitUI_Toolbar"),s.style.width=e.width+2+"px",t.append(s);var i=document.createElement("div");i.classList.add("LogicalCircuitUI_Toolbar_Left"),s.append(i);var o=document.createElement("div");o.classList.add("LogicalCircuitUI_Toolbar_Center"),s.append(o);var n=document.createElement("div");n.classList.add("LogicalCircuitUI_Toolbar_Right"),s.append(n),this.#V(i),this.#Y(i,"OR",(()=>this.#p("OR")),(()=>this.#p("NOR"))),this.#Y(i,"AND",(()=>this.#p("AND")),(()=>this.#p("NAND"))),this.#Y(i,"XOR",(()=>this.#p("XOR")),(()=>this.#p("NXOR"))),this.#Y(i,"NOT",(()=>this.#p("NOT"))),this.#Y(o,"SIMPLIFY",(()=>this.#B()));try{new dagre.graphlib.Graph;this.#Y(o,"TIDY UP",(()=>this.#J(!1)))}catch(t){}this.#Y(n,"CLEAR",(()=>this.#H())),this.#C=document.createElement("canvas"),this.#C.classList.add("LogicalCircuitUI_Canvas"),this.#C.width=e.width,this.#C.height=e.height,this.#C.onmousemove=t=>this.#_(t),this.#C.onmousedown=t=>this.#q(t),this.#C.onmouseup=t=>this.#G(t),t.append(this.#C),this.#v=this.#C.getContext("2d"),this.#v.font=this.#M.font,this.#v.textBaseline="middle",this.#v.lineWidth=this.#M.lineWidth,this.#v.lineJoin="round",this.#Z(),e.bezierConnector&&this.setBezierConnector(!0),e.showOperatorType&&this.setShowOperatorType(!0),e.interactive&&this.setInteractive(!0)}setJSONs(t,e){this.#g.setJSON(t),this.#y=JSON.parse(JSON.stringify(e)),this.setInteractive(this.#M.interactive),this.#$(),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z()}getJSON(){return this.#g.getJSON()}getJSONUI(){return JSON.parse(JSON.stringify(this.#y))}computeExpressions(t){return this.#g.computeExpressions(t)}computeExpression(t,e){return this.#g.computeExpression(t,e)}getJavaScriptExpressions(){return this.#g.getJavaScriptExpressions()}getJavaScriptExpression(t){return this.#g.getJavaScriptExpression(t)}isValid(){return this.#g.isValid()}#V(t){var e=document.createElement("div");e.classList.add("LogicalCircuitUI_TextContainer"),t.append(e);var s=document.createElement("input");s.type="text",s.classList.add("IN-OUT"),s.oninput=t=>{var e=!this.#g.isNameValid(s.value)||this.#g.isNameAlreadyUsed(s.value);i.disabled=e,o.disabled=e},e.append(s);var i=this.#Q(e,"IN",!0),o=this.#Q(e,"OUT",!0);i.onclick=t=>this.#tt(s.value),o.onclick=t=>this.#et(s.value)}#Y(t,e,s,i){var o=document.createElement("div");o.classList.add("LogicalCircuitUI_ButtonContainer"),t.append(o),s&&(this.#Q(o,e,!1).onclick=t=>s(e)),i&&(this.#Q(o,"N"+e,!1).onclick=t=>i(e))}#Q(t,e,s){var i=document.createElement("button");return i.textContent=e,i.classList.add(e.replace(" ","-")),i.disabled=s,t.append(i),i}#tt(t){this.#g.addInput(t)&&(this.#st(t),this.#M.interactive&&(this.#x[t]=!1),this.#$(),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z())}#et(t){this.#g.addOutput(t)&&(this.#st(t),this.#$(),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z())}#p(t){var e=this.#g["add"+t]();this.#st(e),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z()}#st(t){this.#y[t]={top:this.#L.top,left:this.#L.left}}#B(){if(confirm("Do you really want to simplify the current logical circuit?")&&this.#g.simplify()){this.#y={},this.#$();try{new dagre.graphlib.Graph;Object.keys(this.getJSON()).forEach((t=>this.#st(t))),this.setInteractive(this.#M.interactive),this.#N.forEach((t=>t())),this.#J(!0)}catch(e){var t=this.getJSON();Object.keys(t).filter((t=>"IN"===this.#g.getType(t))).forEach(((t,e,s)=>this.#it(t,e,s,this.#L.left))),Object.keys(t).filter((t=>"NOT"===this.#g.getType(t))).forEach(((t,e,s)=>this.#it(t,e,s,this.#C.width/5))),Object.keys(t).filter((t=>"AND"===this.#g.getType(t))).forEach(((t,e,s)=>this.#it(t,e,s,2*this.#C.width/5))),Object.keys(t).filter((t=>"OR"===this.#g.getType(t))).forEach(((t,e,s)=>this.#it(t,e,s,3*this.#C.width/5))),Object.keys(t).filter((t=>"OUT"===this.#g.getType(t))).forEach(((t,e,s)=>this.#it(t,e,s,4*this.#C.width/5))),this.setInteractive(this.#M.interactive),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z()}}}#it(t,e,s,i){this.#y[t]={top:(e+1)*this.#C.height/(s.length+1)-this.#A.height,left:i}}#J(t){if(t||confirm("Do you really want to tidy up the current logical circuit?")){var e=new dagre.graphlib.Graph;for(var s in e.setGraph({rankdir:"LR",marginx:20,marginy:20}),e.setDefaultEdgeLabel((()=>({}))),this.#y)switch(e.setNode(s,{width:this.#k[s].width,height:this.#k[s].height}),this.#g.getType(s)){case"IN":break;case"OUT":e.setEdge(this.#g.getFrom(s)[0],s);break;default:this.#g.getFrom(s).forEach((t=>e.setEdge(t,s)));break}dagre.layout(e);var i=e.graph(),o=i.width>this.#C.width||i.height>this.#C.height?Math.min(this.#C.width/i.width,this.#C.height,i.height):1;e.nodes().forEach((t=>{var s=e.node(t);this.#y[t].left=s.x*o-s.width/2,this.#y[t].top=s.y*o-s.height/2})),this.#I.forEach((t=>t())),this.#Z()}}#H(){confirm("Do you really want to clear the current logical circuit?")&&(this.#g.clear(),this.#y={},this.#$(),this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z())}#$(){document.querySelector("."+this.#O+" input.IN-OUT").value="",document.querySelector("."+this.#O+" button.IN").disabled=!0,document.querySelector("."+this.#O+" button.OUT").disabled=!0}setBezierConnector(t){this.#M.bezierConnector=!!t,this.#Z()}setShowOperatorType(t){this.#M.showOperatorType=!!t,this.#Z()}setInteractive(t){if(this.#M.interactive=!!t,this.#F.selected=!1,this.#x={},t)for(var e in this.#y)"IN"===this.#g.getType(e)&&(this.#x[e]=!1);this.#Z()}addOnChangeListener(t){this.#N.push(t)}addOnChangeUIListener(t){this.#I.push(t)}addBlackListWord(t){this.#g.addBlackListWord(t)}#Z(){for(var t in this.#C.style.cursor=this.#M.cursor,this.#v.clearRect(0,0,this.#C.width,this.#C.height),this.#ot(),this.#y){switch(e=this.#g.getType(t)){case"IN":this.#nt(t,"exit");break;case"OUT":this.#nt(t,"0");break;default:this.#ht(t,e);break}}for(var t in this.#y){var e;switch(e=this.#g.getType(t)){case"IN":break;case"OUT":this.#at(this.#g.getFrom(t)[0],t,0);break;default:this.#g.getFrom(t).forEach(((e,s)=>this.#at(e,t,s)));break}}this.#rt(),this.#ct()}#ot(){this.#v.font=this.#R.font,this.#v.fillText(this.#R.text,this.#C.width-this.#R.left,this.#C.height-this.#R.top),this.#v.font=this.#M.font;var t=this.#v.createRadialGradient(this.#C.width,this.#C.height,this.#R.radius1,this.#C.width,this.#C.height,this.#R.radius2);this.#R.gradients.forEach((e=>t.addColorStop(e.pos,e.color))),this.#v.lineWidth=this.#R.lineWidth,this.#v.strokeStyle=t,this.#v.beginPath(),this.#v.arc(this.#C.width,this.#C.height,this.#R.lineWidth,0,2*Math.PI),this.#v.stroke(),this.#v.lineWidth=this.#M.lineWidth,this.#v.strokeStyle=this.#M.strokeStyle}#nt(t,e){var s=this.#v.measureText(t).width+this.#A.gap+(this.#M.interactive?this.#A.gap:0),i=this.#y[t].top+this.#A.height/2;if(this.#w[t+"*"+e]={left:this.#y[t].left+("exit"===e?s+this.#X.radius:-this.#X.radius),top:i},this.#lt(t+"*"+e),this.#k[t]={width:s,height:this.#A.height},this.#T[t]=new Path2D,this.#T[t].rect(this.#y[t].left,this.#y[t].top,s,this.#A.height),this.#v.stroke(this.#T[t]),this.#M.interactive){var o;o="exit"===e?this.#x[t]?this.#A.ONStyle:this.#A.OFFStyle:this.isValid()?this.computeExpression(t,this.#x)?this.#A.ONStyle:this.#A.OFFStyle:this.#A.circleStyle;var n=this.#A.gap/2-2,h=o===this.#A.ONStyle?this.#y[t].top+2+n+2:this.#y[t].top+this.#A.height-2-n-2,a=new Path2D;a.roundRect(this.#y[t].left+s-this.#A.gap-2,this.#y[t].top+2,this.#A.gap,this.#A.height-4,this.#A.gap/2),"exit"===e&&(this.#E[t]=a),this.#v.fillStyle=o,this.#v.fill(a),this.#v.fillStyle=this.#A.circleStyle,this.#v.beginPath(),this.#v.arc(this.#y[t].left+s-this.#A.gap/2-2,h,n,0,2*Math.PI),this.#v.fill(),this.#v.fillStyle=this.#M.strokeStyle}this.#v.fillText(t,this.#y[t].left+this.#A.gap/2,this.#w[t+"*"+e].top)}#ht(t,e){this.#T[t]=new Path2D;var s=this.#g.getFrom(t),i=this.#K.oneHeight*s.length/2,o=this.#y[t].left+this.#K.lineWidth+("NOT"===e?this.#K.radiusLeft:0),n=this.#y[t].top+this.#K.oneHeight*("NOT"===e?2:s.length),h=this.#y[t].top+("NOT"===e?this.#K.oneHeight:i);this.#dt(t,e,o,h),this.#ut(t,e,s,h,i),this.#ft(t,e,s,o,h),this.#pt(t,e,o,n,h,i),this.#mt(t,e)}#dt(t,e,s,i){switch(e){case"OR":case"AND":case"XOR":this.#w[t+"*exit"]={left:s+this.#K.radiusLeft+this.#X.radius,top:i};break;case"NOR":case"NAND":case"NXOR":this.#w[t+"*exit"]={left:s+this.#K.radiusLeft+2*this.#K.notRadius+this.#X.radius,top:i};break;case"NOT":this.#w[t+"*exit"]={left:s+2*this.#K.notRadius+this.#X.radius,top:i};break}this.#lt(t+"*exit")}#ut(t,e,s,i,o){for(var n=Math.PI/(s.length+1),h=0;h<s.length;h++){switch(e){case"OR":case"NOR":var a=n*(h+1)-Math.PI/2;this.#w[t+"*"+h]={left:this.#y[t].left+(this.#K.radiusLeft-this.#X.radius)*Math.cos(a),top:i+(o-this.#X.radius)*Math.sin(a)};break;case"AND":case"NAND":this.#w[t+"*"+h]={left:this.#y[t].left-this.#X.radius,top:this.#y[t].top+this.#K.oneHeight/2+this.#K.oneHeight*h};break;case"XOR":case"NXOR":a=n*(h+1)-Math.PI/2;this.#w[t+"*"+h]={left:this.#y[t].left+(this.#K.radiusLeft-this.#X.radius)*Math.cos(a)-this.#K.xorGap,top:i+(o-this.#X.radius)*Math.sin(a)};break;case"NOT":this.#w[t+"*"+h]={left:this.#y[t].left-this.#X.radius,top:i};break}this.#lt(t+"*"+h)}}#ft(t,e,s,i,o){switch(e){case"OR":case"AND":case"XOR":this.#k[t]={width:this.#K.lineWidth+this.#K.radiusLeft,height:this.#K.oneHeight*s.length};break;case"NOR":case"NAND":case"NXOR":(n=new Path2D).arc(i+this.#K.radiusLeft+this.#K.notRadius,o,this.#K.notRadius,0,2*Math.PI),this.#T[t].addPath(n),this.#k[t]={width:this.#K.lineWidth+this.#K.radiusLeft+2*this.#K.notRadius,height:this.#K.oneHeight*s.length};break;case"NOT":var n;(n=new Path2D).arc(i+this.#K.notRadius,o,this.#K.notRadius,0,2*Math.PI),this.#T[t].addPath(n),this.#k[t]={width:this.#K.lineWidth+this.#K.radiusLeft+2*this.#K.notRadius,height:2*this.#K.oneHeight};break}}#pt(t,e,s,i,o,n){switch("NOT"!==e&&(this.#T[t].moveTo(s,i),this.#T[t].lineTo(this.#y[t].left,i)),e){case"OR":case"NOR":this.#T[t].ellipse(this.#y[t].left,o,this.#K.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#T[t].lineTo(s,this.#y[t].top),this.#T[t].ellipse(s,o,this.#K.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"AND":case"NAND":this.#T[t].lineTo(this.#y[t].left,this.#y[t].top),this.#T[t].lineTo(s,this.#y[t].top),this.#T[t].ellipse(s,o,this.#K.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":this.#T[t].ellipse(this.#y[t].left,o,this.#K.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#T[t].lineTo(s,this.#y[t].top),this.#T[t].ellipse(s,o,this.#K.radiusLeft,n,0,-Math.PI/2,Math.PI/2);var h=new Path2D;h.ellipse(this.#y[t].left-this.#K.xorGap,o,this.#K.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#T[t].addPath(h);break;case"NOT":this.#T[t].moveTo(this.#y[t].left,this.#y[t].top),this.#T[t].lineTo(s,o),this.#T[t].lineTo(this.#y[t].left,i),this.#T[t].closePath();break}this.#v.stroke(this.#T[t])}#mt(t,e){if(this.#M.showOperatorType){var s;switch(this.#v.font=this.#K.font,e){case"OR":case"XOR":s=this.#K.radiusLeft+(this.#k[t].width-this.#K.radiusLeft-this.#v.measureText(e).width)/2;break;case"AND":s=(this.#k[t].width-this.#v.measureText(e).width)/2;break;case"NOR":case"NXOR":s=this.#K.radiusLeft+(this.#k[t].width-this.#K.radiusLeft-this.#v.measureText(e).width)/2-this.#K.notRadius;break;case"NAND":s=(this.#k[t].width-this.#v.measureText(e).width)/2-this.#K.notRadius;break;case"NOT":s=(this.#k[t].width-this.#v.measureText(e).width)/4;break}this.#v.fillText(e,this.#y[t].left+s,this.#y[t].top+this.#k[t].height/2),this.#v.font=this.#M.font}}#lt(t){this.#P[t]=new Path2D,this.#P[t].moveTo(this.#w[t].left,this.#w[t].top-this.#X.radius),this.#P[t].lineTo(this.#w[t].left+this.#X.radius,this.#w[t].top),this.#P[t].lineTo(this.#w[t].left,this.#w[t].top+this.#X.radius),this.#P[t].lineTo(this.#w[t].left-this.#X.radius,this.#w[t].top),this.#P[t].closePath(),this.#v.stroke(this.#P[t])}#at(t,e,s){if(t){if(this.#j[e+"*"+s]=new Path2D,this.#j[e+"*"+s].moveTo(this.#w[t+"*exit"].left,this.#w[t+"*exit"].top),this.#M.bezierConnector){var i={left:this.#w[t+"*exit"].left+(this.#w[e+"*"+s].left-this.#w[t+"*exit"].left)/2,top:this.#w[t+"*exit"].top},o={left:i.left,top:this.#w[e+"*"+s].top};this.#j[e+"*"+s].bezierCurveTo(i.left,i.top,o.left,o.top,this.#w[e+"*"+s].left,this.#w[e+"*"+s].top)}else this.#j[e+"*"+s].lineTo(this.#w[e+"*"+s].left,this.#w[e+"*"+s].top);this.#v.stroke(this.#j[e+"*"+s])}}#rt(){if(this.#D.name){var t=this.#g.getType(this.#D.name);"symbolPath"!==this.#D.referencePath||(this.#M.interactive&&"IN"===t?(this.#F.selected=this.#v.isPointInPath(this.#E[this.#D.name],this.#S.offsetX,this.#S.offsetY),this.#C.style.cursor=this.#F.selected?this.#U.pointer:this.#U.grab):["IN","OUT","NOT"].includes(t)?this.#C.style.cursor=this.#U.grab:this.#bt()),this.#gt()}else;}#bt(){var t=this.#y[this.#D.name].left+3*this.#k[this.#D.name].width/5;switch(this.#g.getType(this.#D.name)){case"OR":case"AND":case"XOR":break;case"NOR":case"NAND":case"NXOR":t-=this.#K.notRadius;break}var e=this.#g.getFrom(this.#D.name).length,s=this.#y[this.#D.name].top+this.#k[this.#D.name].height/4,i=this.#y[this.#D.name].top+3*this.#k[this.#D.name].height/4;this.#v.font=this.#z.font;var o=this.#v.measureText(this.#z.up).width,n=this.#v.measureText(this.#z.down).width,h=Math.max(o,n),a=new Path2D,r=new Path2D;this.#v.fillStyle=e>2?this.#z.canDoStrokeStyle:this.#z.cannotDoStrokeStyle,r.rect(t-2,this.#y[this.#D.name].top+3,h+4,this.#k[this.#D.name].height/2-3),a.addPath(r),this.#v.fill(r),this.#v.stroke(r),r=new Path2D,this.#v.fillStyle=e<this.#z.max?this.#z.canDoStrokeStyle:this.#z.cannotDoStrokeStyle,r.rect(t-2,this.#y[this.#D.name].top+this.#k[this.#D.name].height/2,h+4,this.#k[this.#D.name].height/2-3),a.addPath(r),this.#v.fill(r),this.#v.stroke(r),this.#v.fillStyle=this.#M.strokeStyle,this.#v.fillText(this.#z.up,t+(h-o)/2,s),this.#v.fillText(this.#z.down,t+(h-n)/2,i),this.#v.font=this.#M.font,this.#z.selected=this.#v.isPointInPath(a,this.#S.offsetX,this.#S.offsetY),this.#z.name=this.#D.name,this.#z.direction=this.#S.offsetY<this.#y[this.#D.name].top+this.#k[this.#D.name].height/2?"UP":"DOWN",this.#z.selected?"UP"===this.#z.direction&&e>2||"DOWN"===this.#z.direction&&e<this.#z.max?this.#C.style.cursor=this.#U.pointer:this.#C.style.cursor=this.#U.notAllowed:this.#C.style.cursor=this.#U.grab}#gt(){this.#v.lineWidth=this.#D.lineWidth,this.#W.pressed?(this.#C.style.cursor=this.#U.grabbing,this.#v.strokeStyle=this.#yt(this.#C.width,this.#C.height,this.#R.lineWidth,this.#y[this.#D.name].left,this.#y[this.#D.name].top,this.#k[this.#D.name].width,this.#k[this.#D.name].height)?this.#R.strokeStyle:this.#D.strokeStyle):this.#v.strokeStyle="connectorPath"===this.#D.referencePath?this.#R.strokeStyle:this.#D.strokeStyle,this.#v.stroke(this.#xt(this.#D.referencePath,this.#D.referenceName)),this.#v.lineWidth=this.#M.lineWidth,this.#v.strokeStyle=this.#M.strokeStyle}#ct(){if(this.#X.pressed){if(this.#v.beginPath(),this.#v.moveTo(this.#X.event.offsetX,this.#X.event.offsetY),this.#M.bezierConnector){var t={left:this.#X.event.offsetX+(this.#S.offsetX-this.#X.event.offsetX)/2,top:this.#X.event.offsetY},e={left:t.left,top:this.#S.offsetY};this.#v.bezierCurveTo(t.left,t.top,e.left,e.top,this.#S.offsetX,this.#S.offsetY)}else this.#v.lineTo(this.#S.offsetX,this.#S.offsetY);this.#v.stroke(),this.#X.name&&(this.#v.lineWidth=this.#X.lineWidth,this.#v.strokeStyle=this.#Ot(this.#D.name,this.#D.index,this.#X.name,this.#X.index)?this.#X.canDoStrokeStyle:this.#X.cannotDoStrokeStyle,this.#v.stroke(this.#P[this.#X.referenceName]),this.#v.lineWidth=this.#M.lineWidth,this.#v.strokeStyle=this.#M.strokeStyle)}}#yt(t,e,s,i,o,n,h){var a=t,r=e;t<i?a=i:t>i+n&&(a=i+n),e<o?r=o:e>o+h&&(r=o+h);var c=t-a,l=e-r;return Math.sqrt(c*c+l*l)<=s}#xt(t,e){switch(t){case"symbolPath":return this.#T[e];case"knobPath":return this.#P[e];case"connectorPath":return this.#j[e]}}#Ot(t,e,s,i){var o=this.#g.getType(t),n=this.#g.getType(s);return("IN"!==o||"IN"!==n)&&("IN"===o&&"OUT"===n?this.#g.isConnectionValid(t,s):"IN"===o?-1!==i&&this.#g.isConnectionValid(t,s):"OUT"===o&&"IN"===n?this.#g.isConnectionValid(s,t):("OUT"!==o||"OUT"!==n)&&("OUT"===o?-1===i&&this.#g.isConnectionValid(s,t):"IN"===n?-1!==e&&this.#g.isConnectionValid(s,t):"OUT"===n?-1===e&&this.#g.isConnectionValid(t,s):(-1!==e||-1!==i)&&((-1===e||-1===i)&&(-1===e?this.#g.isConnectionValid(t,s):-1===i&&this.#g.isConnectionValid(s,t)))))}#_(t){this.#S=t;var e=Math.sqrt(Math.pow(t.offsetX-this.#C.width,2)+Math.pow(t.offsetY-this.#C.height,2));this.#C.setAttribute("title",e<this.#R.radius2?"To trash an element move and release it here":""),this.#W.pressed?(this.#y[this.#D.name].top=t.offsetY-this.#W.offsetTop,this.#y[this.#D.name].left=t.offsetX-this.#W.offsetLeft,this.#I.forEach((t=>t()))):this.#X.pressed?this.#Ct(t):this.#vt(t),this.#Z()}#Ct(t){for(var e in this.#X.name="",this.#y)switch(this.#g.getType(e)){case"IN":!this.#X.name&&this.#v.isPointInPath(this.#P[e+"*exit"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=-1,this.#X.referenceName=e+"*exit");break;case"OUT":this.#g.getFrom(e).forEach(((s,i)=>{!this.#X.name&&this.#v.isPointInPath(this.#P[e+"*"+i],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=i,this.#X.referenceName=e+"*"+i)}));break;default:!this.#X.name&&this.#v.isPointInPath(this.#P[e+"*exit"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=-1,this.#X.referenceName=e+"*exit"),this.#g.getFrom(e).forEach(((s,i)=>{!this.#X.name&&this.#v.isPointInPath(this.#P[e+"*"+i],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=i,this.#X.referenceName=e+"*"+i)}));break}}#vt(t){for(var e in this.#D.name="",this.#y){switch(this.#g.getType(e)){case"IN":!this.#D.name&&this.#v.isPointInPath(this.#P[e+"*exit"],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=-1,this.#D.referencePath="knobPath",this.#D.referenceName=e+"*exit");break;case"OUT":!this.#D.name&&this.#v.isPointInPath(this.#P[e+"*0"],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=0,this.#D.referencePath="knobPath",this.#D.referenceName=e+"*0"),!this.#D.name&&this.#g.getFrom(e)[0]&&this.#v.isPointInStroke(this.#j[e+"*0"],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=0,this.#D.referencePath="connectorPath",this.#D.referenceName=e+"*0");break;default:!this.#D.name&&this.#v.isPointInPath(this.#P[e+"*exit"],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=-1,this.#D.referencePath="knobPath",this.#D.referenceName=e+"*exit"),this.#g.getFrom(e).forEach(((s,i)=>{!this.#D.name&&this.#v.isPointInPath(this.#P[e+"*"+i],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=i,this.#D.referencePath="knobPath",this.#D.referenceName=e+"*"+i),!this.#D.name&&s&&this.#v.isPointInStroke(this.#j[e+"*"+i],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.index=i,this.#D.referencePath="connectorPath",this.#D.referenceName=e+"*"+i)}));break}!this.#D.name&&this.#v.isPointInPath(this.#T[e],t.offsetX,t.offsetY)&&(this.#D.name=e,this.#D.referencePath="symbolPath",this.#D.referenceName=e)}}#q(t){if(this.#D.name)switch(this.#D.referencePath){case"knobPath":this.#X.pressed=!0,this.#X.event=t;break;case"symbolPath":if(this.#z.selected){var e=this.#g.getFrom(this.#z.name).length;switch(this.#z.direction){case"UP":e>2&&(this.#g.decConnector(this.#z.name),this.#y[this.#z.name].top+=this.#K.oneHeight/2,this.#N.forEach((t=>t())),this.#I.forEach((t=>t())));break;case"DOWN":e<this.#z.max&&(this.#g.incConnector(this.#z.name),this.#y[this.#z.name].top-=this.#K.oneHeight/2,this.#N.forEach((t=>t())),this.#I.forEach((t=>t())));break}this.#Z()}else this.#F.selected?(this.#x[this.#D.name]=!this.#x[this.#D.name],this.#Z()):(this.#W.pressed=!0,this.#W.offsetLeft=t.offsetX-this.#y[this.#D.name].left,this.#W.offsetTop=t.offsetY-this.#y[this.#D.name].top,this.#C.style.cursor=this.#U.grabbing);break;case"connectorPath":this.#g.removeConnection(this.#D.name,this.#D.index),this.#D.name="",this.#N.forEach((t=>t())),this.#I.forEach((t=>t())),this.#Z();break}}#G(t){if(this.#D.name&&this.#W.pressed&&this.#yt(this.#C.width,this.#C.height,this.#R.lineWidth,this.#y[this.#D.name].left,this.#y[this.#D.name].top,this.#k[this.#D.name].width,this.#k[this.#D.name].height))this.#g.remove(this.#D.name),delete this.#y[this.#D.name],this.#D.name="",this.#N.forEach((t=>t())),this.#I.forEach((t=>t()));else if(this.#X.pressed&&this.#X.name&&this.#Ot(this.#D.name,this.#D.index,this.#X.name,this.#X.index)){var e=this.#g.getType(this.#D.name),s=this.#g.getType(this.#X.name);"IN"===e?this.#g.addConnection(this.#D.name,this.#X.name,this.#X.index):"IN"===s?this.#g.addConnection(this.#X.name,this.#D.name,this.#D.index):"OUT"===e?this.#g.addConnection(this.#X.name,this.#D.name,0):"OUT"===s?this.#g.addConnection(this.#D.name,this.#X.name,0):-1===this.#D.index?this.#g.addConnection(this.#D.name,this.#X.name,this.#X.index):-1===this.#X.index&&this.#g.addConnection(this.#X.name,this.#D.name,this.#D.index),this.#N.forEach((t=>t())),this.#I.forEach((t=>t()))}this.#X.pressed=!1,this.#W.pressed=!1,this.#z.selected=!1,this.#Z()}}
class LogicalCircuit{#t={};#e=["OR","NOR","AND","NAND","XOR","NXOR","NOT","BREAK","CASE","CATCH","CLASS","CONST","CONTINUE","DEBUGGER","DEFAULT","DELETE","DO","ELSE","EXPORT","EXTENDS","FALSE","FINALLY","FOR","FUNCTION","IF","IMPORT","IN","INSTANCEOF","NEW","NULL","RETURN","SUPER","SWITCH","THIS","THROW","TRUE","TRY","TYPEOF","VAR","VOID","WHILE","WITH","LET","STATIC","YIELD","AWAIT","ENUM","IMPLEMENTS","INTERFACE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","ABSTRACT","BOOLEAN","BYTE","CHAR","DOUBLE","FINAL","FLOAT","GOTO","INT","LONG","NATIVE","SHORT","SYNCHRONIZED","THROWS","TRANSIENT","VOLATILE","ARGUMENTS","AS","ASYNC","EVAL","FROM","GET","OF","SET"];#s=["OR","NOR","AND","NAND","XOR","NXOR","NOT"];#i={OR:"||",AND:"&&",NOR:"||",NAND:"&&"};constructor(){}setJSON(t){this.#t=JSON.parse(JSON.stringify(t))}getJSON(){return JSON.parse(JSON.stringify(this.#t))}computeExpressions(t){var e={};return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((s=>e[s]=this.computeExpression(s,t))),e}computeExpression(name,parameters){var result,toEval="",expressions=this.getJavaScriptExpression(name);for(var property in expressions.xor&&(toEval="var xor = "+expressions.xor+";\n"),parameters)toEval+="var "+property+" = "+parameters[property]+";\n";return toEval+="result = "+expressions[name]+";",eval(toEval),result}getJavaScriptExpressions(){var t={};return this.isValid()&&(Object.keys(this.#t).some((t=>["XOR","NXOR"].includes(this.#t[t].type)))&&(t.xor="(...a)=>a.filter(e=>e).length==1"),Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t[e]=this.#o(this.#t[e].from[0],!1)))),t}getJavaScriptExpression(t){var e={};return this.isValid()&&this.#t[t]&&"OUT"===this.#t[t].type&&(Object.keys(this.#t).some((t=>["XOR","NXOR"].includes(this.#t[t].type)))&&(e.xor="(...a)=>a.filter(e=>e).length==1"),e[t]=this.#o(this.#t[t].from[0],!1)),e}#o(t,e){if("IN"===this.#t[t].type)return t;if("NOT"===this.#t[t].type)return"!"+this.#o(this.#t[t].from[0],!0);var s=[];switch(this.#t[t].type){case"OR":case"AND":case"NOR":case"NAND":this.#t[t].from.forEach((t=>s.push(this.#o(t,!0))));break;case"XOR":case"NXOR":this.#t[t].from.forEach((t=>s.push(this.#o(t,!1))));break}switch(this.#t[t].type){case"OR":case"AND":return(e?"(":"")+s.join(this.#i[this.#t[t].type])+(e?")":"");case"NOR":case"NAND":return"!("+s.join(this.#i[this.#t[t].type])+")";case"XOR":return"xor("+s.join(",")+")";case"NXOR":return"!xor("+s.join(",")+")"}}isValid(){var t=!0;return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t&=this.#n(e))),!!t}#n(t){var e=!0;return this.#t[t].from.forEach((t=>{(e&=!!t)&&"IN"!==this.#t[t].type&&(e&=!!this.#n(t))})),!!e}addInput(t){return this.#h(t,{type:"IN"})}addOutput(t){return this.#h(t,{type:"OUT",from:[""]})}addOR(){return this.#a("OR",["",""])}addNOR(){return this.#a("NOR",["",""])}addAND(){return this.#a("AND",["",""])}addNAND(){return this.#a("NAND",["",""])}addXOR(){return this.#a("XOR",["",""])}addNXOR(){return this.#a("NXOR",["",""])}addNOT(){return this.#a("NOT",[""])}#a(t,e){var s=this.#r();return this.#h(s,{type:t,from:e}),s}#h(t,e){return!(!this.isNameValid(t)||this.isNameAlreadyUsed(t))&&(this.#t[t]=e,!0)}#r(){return"LogicalCircuit_Operator_"+(new Date).getTime()}incConnector(t){this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.push("")}decConnector(t){if(this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.length>2){var e=this.#t[t].from.indexOf("");-1!==e?this.#t[t].from.splice(e,1):this.#t[t].from.pop()}}addConnection(t,e,s){this.isConnectionValid(t,e)&&0<=s&&s<this.#t[e].from.length&&(this.#t[e].from[s]=t)}isConnectionValid(t,e){return!(t===e||!this.#t[t]||!this.#t[e])&&("IN"===this.#t[t].type?"IN"!==this.#t[e].type:"OUT"!==this.#t[t].type&&("IN"!==this.#t[e].type&&("OUT"===this.#t[e].type||!this.#c(t,e))))}#c(t,e){var s=Object.keys(this.#t).filter((t=>this.#s.includes(this.#t[t].type)&&this.#t[t].from.includes(e)));if(s.includes(t))return!0;var i=!1;return s.forEach((e=>i|=this.#c(t,e))),i}removeConnection(t,e){this.#t[t]&&0<=e&&e<this.#t[t].from.length&&(this.#t[t].from[e]="")}remove(t){if(this.#t[t])for(var e in delete this.#t[t],this.#t)switch(this.#t[e].type){case"IN":break;case"OUT":default:this.#t[e].from=this.#t[e].from.map((e=>e===t?"":e));break}}clear(){this.#t={}}getType(t){return this.#t[t]?this.#t[t].type:""}getFrom(t){if(!this.#t[t])return[];switch(this.#t[t].type){case"IN":return[];case"OUT":default:return this.#t[t].from.slice()}}isNameValid(t){return"string"==typeof t&&(/^[a-z]+[a-z0-9_]*$/i.test(t)&&!this.#e.includes(t.toUpperCase()))}isNameAlreadyUsed(t){return!!this.#t[t]}addBlackListWord(t){t&&this.#e.push(t.toUpperCase())}}class LogicalCircuitUI{#l=new LogicalCircuit;#d={};#u={};#f;#p;#b;#m=[];#g=[];#x={};#y={};#C={};#N={};#O={};#I={};#v;#P={width:800,height:600,font:"24px sans-serif",lineWidth:2,strokeStyle:"black",cursor:"default",bezierConnector:!1,showOperatorType:!1,interactive:!1};#w={grab:"grab",pointer:"pointer",notAllowed:"not-allowed",grabbing:"grabbing"};#T={top:15,left:15};#k={font:"48px sans-serif",text:"ðŸ—‘",strokeStyle:"red",left:35,top:20,lineWidth:80,radius1:40,radius2:120,gradients:[{pos:0,color:"rgba(0,0,0,0)"},{pos:.5,color:"rgba(0,0,0,0)"},{pos:1,color:"rgba(0,0,0,0.3)"}]};#S={gap:20,height:40,ONStyle:"green",OFFStyle:"gray",circleStyle:"white"};#M={radiusLeft:20,lineWidth:30,oneHeight:20,xorGap:12,notRadius:7,font:"9px sans-serif"};#U={name:"",index:-1,referencePath:"",referenceName:"",lineWidth:3,strokeStyle:"green"};#j={pressed:!1,name:"",index:-1,referenceName:"",event:null,canDoStrokeStyle:"green",cannotDoStrokeStyle:"orange",lineWidth:3,radius:5};#E={pressed:!1,name:"",offsetLeft:0,offsetTop:0};#L={selected:!1,name:"",direction:"",font:"14px sans-serif",up:"-",down:"+",max:6,canDoStrokeStyle:"white",cannotDoStrokeStyle:"gray"};#R={selected:!1};constructor(t,e){try{e.width}catch(t){e={}}e.width=isNaN(e.width)||e.width<0?this.#P.width:e.width,e.height=isNaN(e.height)||e.height<0?this.#P.height:e.height,this.#f="LogicalCircuitUI_Container_"+(new Date).getTime(),t.classList.add("LogicalCircuitUI_Container"),t.classList.add(this.#f),t.style.width=e.width+2+"px";var s=document.createElement("div");s.classList.add("LogicalCircuitUI_Toolbar"),s.style.width=e.width+2+"px",t.append(s);var i=document.createElement("div");i.classList.add("LogicalCircuitUI_Toolbar_Left"),s.append(i);var o=document.createElement("div");o.classList.add("LogicalCircuitUI_Toolbar_Right"),s.append(o),this.#A(i),this.#K(i,"OR",(()=>this.#h("OR")),(()=>this.#h("NOR"))),this.#K(i,"AND",(()=>this.#h("AND")),(()=>this.#h("NAND"))),this.#K(i,"XOR",(()=>this.#h("XOR")),(()=>this.#h("NXOR"))),this.#K(i,"NOT",(()=>this.#h("NOT")));try{new dagre.graphlib.Graph;this.#K(i,"TIDY UP",(()=>this.#D()))}catch(t){}this.#K(o,"CLEAR",(()=>this.#X())),this.#p=document.createElement("canvas"),this.#p.classList.add("LogicalCircuitUI_Canvas"),this.#p.width=e.width,this.#p.height=e.height,this.#p.onmousemove=t=>this.#W(t),this.#p.onmousedown=t=>this.#z(t),this.#p.onmouseup=t=>this.#F(t),t.append(this.#p),this.#b=this.#p.getContext("2d"),this.#b.font=this.#P.font,this.#b.textBaseline="middle",this.#b.lineWidth=this.#P.lineWidth,this.#b.lineJoin="round",this.#Y(),e.bezierConnector&&this.setBezierConnector(!0),e.showOperatorType&&this.setShowOperatorType(!0),e.interactive&&this.setInteractive(!0)}setJSONs(t,e){this.#l.setJSON(t),this.#d=JSON.parse(JSON.stringify(e)),this.setInteractive(this.#P.interactive),this.#B(),this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y()}getJSON(){return this.#l.getJSON()}getJSONUI(){return JSON.parse(JSON.stringify(this.#d))}computeExpressions(t){return this.#l.computeExpressions(t)}computeExpression(t,e){return this.#l.computeExpression(t,e)}getJavaScriptExpressions(){return this.#l.getJavaScriptExpressions()}getJavaScriptExpression(t){return this.#l.getJavaScriptExpression(t)}isValid(){return this.#l.isValid()}#A(t){var e=document.createElement("div");e.classList.add("LogicalCircuitUI_TextContainer"),t.append(e);var s=document.createElement("input");s.type="text",s.classList.add("IN-OUT"),s.oninput=t=>{var e=!this.#l.isNameValid(s.value)||this.#l.isNameAlreadyUsed(s.value);i.disabled=e,o.disabled=e},e.append(s);var i=this.#V(e,"IN",!0),o=this.#V(e,"OUT",!0);i.onclick=t=>this.#J(s.value),o.onclick=t=>this.#H(s.value)}#K(t,e,s,i){var o=document.createElement("div");o.classList.add("LogicalCircuitUI_ButtonContainer"),t.append(o),s&&(this.#V(o,e,!1).onclick=t=>s(e)),i&&(this.#V(o,"N"+e,!1).onclick=t=>i(e))}#V(t,e,s){var i=document.createElement("button");return i.textContent=e,i.classList.add(e.replace(" ","-")),i.disabled=s,t.append(i),i}#J(t){this.#l.addInput(t)&&(this.#G(t),this.#P.interactive&&(this.#u[t]=!1),this.#B(),this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y())}#H(t){this.#l.addOutput(t)&&(this.#G(t),this.#B(),this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y())}#h(t){var e=this.#l["add"+t]();this.#G(e),this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y()}#G(t){this.#d[t]={top:this.#T.top,left:this.#T.left}}#D(){if(confirm("Do you really want to tidy up the current logical circuit?")){var t=new dagre.graphlib.Graph;for(var e in t.setGraph({rankdir:"LR",marginx:20,marginy:20}),t.setDefaultEdgeLabel((()=>({}))),this.#d)switch(t.setNode(e,{width:this.#N[e].width,height:this.#N[e].height}),this.#l.getType(e)){case"IN":break;case"OUT":t.setEdge(this.#l.getFrom(e)[0],e);break;default:this.#l.getFrom(e).forEach((s=>t.setEdge(s,e)));break}dagre.layout(t);var s=t.graph(),i=s.width>this.#p.width||s.height>this.#p.height?Math.min(this.#p.width/s.width,this.#p.height,s.height):1;t.nodes().forEach((e=>{var s=t.node(e);this.#d[e].left=s.x*i-s.width/2,this.#d[e].top=s.y*i-s.height/2})),this.#g.forEach((t=>t())),this.#Y()}}#X(){confirm("Do you really want to clear the current logical circuit?")&&(this.#l.clear(),this.#d={},this.#B(),this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y())}#B(){document.querySelector("."+this.#f+" input.IN-OUT").value="",document.querySelector("."+this.#f+" button.IN").disabled=!0,document.querySelector("."+this.#f+" button.OUT").disabled=!0}setBezierConnector(t){this.#P.bezierConnector=!!t,this.#Y()}setShowOperatorType(t){this.#P.showOperatorType=!!t,this.#Y()}setInteractive(t){if(this.#P.interactive=!!t,this.#R.selected=!1,this.#u={},t)for(var e in this.#d)"IN"===this.#l.getType(e)&&(this.#u[e]=!1);this.#Y()}addOnChangeListener(t){this.#m.push(t)}addOnChangeUIListener(t){this.#g.push(t)}addBlackListWord(t){this.#l.addBlackListWord(t)}#Y(){for(var t in this.#p.style.cursor=this.#P.cursor,this.#b.clearRect(0,0,this.#p.width,this.#p.height),this.#_(),this.#d){switch(e=this.#l.getType(t)){case"IN":this.#q(t,"exit");break;case"OUT":this.#q(t,"0");break;default:this.#Z(t,e);break}}for(var t in this.#d){var e;switch(e=this.#l.getType(t)){case"IN":break;case"OUT":this.#$(this.#l.getFrom(t)[0],t,0);break;default:this.#l.getFrom(t).forEach(((e,s)=>this.#$(e,t,s)));break}}this.#Q(),this.#tt()}#_(){this.#b.font=this.#k.font,this.#b.fillText(this.#k.text,this.#p.width-this.#k.left,this.#p.height-this.#k.top),this.#b.font=this.#P.font;var t=this.#b.createRadialGradient(this.#p.width,this.#p.height,this.#k.radius1,this.#p.width,this.#p.height,this.#k.radius2);this.#k.gradients.forEach((e=>t.addColorStop(e.pos,e.color))),this.#b.lineWidth=this.#k.lineWidth,this.#b.strokeStyle=t,this.#b.beginPath(),this.#b.arc(this.#p.width,this.#p.height,this.#k.lineWidth,0,2*Math.PI),this.#b.stroke(),this.#b.lineWidth=this.#P.lineWidth,this.#b.strokeStyle=this.#P.strokeStyle}#q(t,e){var s=this.#b.measureText(t).width+this.#S.gap+(this.#P.interactive?this.#S.gap:0),i=this.#d[t].top+this.#S.height/2;if(this.#y[t+"*"+e]={left:this.#d[t].left+("exit"===e?s+this.#j.radius:-this.#j.radius),top:i},this.#et(t+"*"+e),this.#N[t]={width:s,height:this.#S.height},this.#C[t]=new Path2D,this.#C[t].rect(this.#d[t].left,this.#d[t].top,s,this.#S.height),this.#b.stroke(this.#C[t]),this.#P.interactive){var o;o="exit"===e?this.#u[t]?this.#S.ONStyle:this.#S.OFFStyle:this.isValid()?this.computeExpression(t,this.#u)?this.#S.ONStyle:this.#S.OFFStyle:this.#S.circleStyle;var n=this.#S.gap/2-2,h=o===this.#S.ONStyle?this.#d[t].top+2+n+2:this.#d[t].top+this.#S.height-2-n-2,a=new Path2D;a.roundRect(this.#d[t].left+s-this.#S.gap-2,this.#d[t].top+2,this.#S.gap,this.#S.height-4,this.#S.gap/2),"exit"===e&&(this.#I[t]=a),this.#b.fillStyle=o,this.#b.fill(a),this.#b.fillStyle=this.#S.circleStyle,this.#b.beginPath(),this.#b.arc(this.#d[t].left+s-this.#S.gap/2-2,h,n,0,2*Math.PI),this.#b.fill(),this.#b.fillStyle=this.#P.strokeStyle}this.#b.fillText(t,this.#d[t].left+this.#S.gap/2,this.#y[t+"*"+e].top)}#Z(t,e){this.#C[t]=new Path2D;var s=this.#l.getFrom(t),i=this.#M.oneHeight*s.length/2,o=this.#d[t].left+this.#M.lineWidth+("NOT"===e?this.#M.radiusLeft:0),n=this.#d[t].top+this.#M.oneHeight*("NOT"===e?2:s.length),h=this.#d[t].top+("NOT"===e?this.#M.oneHeight:i);this.#st(t,e,o,h),this.#it(t,e,s,h,i),this.#ot(t,e,s,o,h),this.#nt(t,e,o,n,h,i),this.#ht(t,e)}#st(t,e,s,i){switch(e){case"OR":case"AND":case"XOR":this.#y[t+"*exit"]={left:s+this.#M.radiusLeft+this.#j.radius,top:i};break;case"NOR":case"NAND":case"NXOR":this.#y[t+"*exit"]={left:s+this.#M.radiusLeft+2*this.#M.notRadius+this.#j.radius,top:i};break;case"NOT":this.#y[t+"*exit"]={left:s+2*this.#M.notRadius+this.#j.radius,top:i};break}this.#et(t+"*exit")}#it(t,e,s,i,o){for(var n=Math.PI/(s.length+1),h=0;h<s.length;h++){switch(e){case"OR":case"NOR":var a=n*(h+1)-Math.PI/2;this.#y[t+"*"+h]={left:this.#d[t].left+(this.#M.radiusLeft-this.#j.radius)*Math.cos(a),top:i+(o-this.#j.radius)*Math.sin(a)};break;case"AND":case"NAND":this.#y[t+"*"+h]={left:this.#d[t].left-this.#j.radius,top:this.#d[t].top+this.#M.oneHeight/2+this.#M.oneHeight*h};break;case"XOR":case"NXOR":a=n*(h+1)-Math.PI/2;this.#y[t+"*"+h]={left:this.#d[t].left+(this.#M.radiusLeft-this.#j.radius)*Math.cos(a)-this.#M.xorGap,top:i+(o-this.#j.radius)*Math.sin(a)};break;case"NOT":this.#y[t+"*"+h]={left:this.#d[t].left-this.#j.radius,top:i};break}this.#et(t+"*"+h)}}#ot(t,e,s,i,o){switch(e){case"OR":case"AND":case"XOR":this.#N[t]={width:this.#M.lineWidth+this.#M.radiusLeft,height:this.#M.oneHeight*s.length};break;case"NOR":case"NAND":case"NXOR":(n=new Path2D).arc(i+this.#M.radiusLeft+this.#M.notRadius,o,this.#M.notRadius,0,2*Math.PI),this.#C[t].addPath(n),this.#N[t]={width:this.#M.lineWidth+this.#M.radiusLeft+2*this.#M.notRadius,height:this.#M.oneHeight*s.length};break;case"NOT":var n;(n=new Path2D).arc(i+this.#M.notRadius,o,this.#M.notRadius,0,2*Math.PI),this.#C[t].addPath(n),this.#N[t]={width:this.#M.lineWidth+this.#M.radiusLeft+2*this.#M.notRadius,height:2*this.#M.oneHeight};break}}#nt(t,e,s,i,o,n){switch("NOT"!==e&&(this.#C[t].moveTo(s,i),this.#C[t].lineTo(this.#d[t].left,i)),e){case"OR":case"NOR":this.#C[t].ellipse(this.#d[t].left,o,this.#M.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#C[t].lineTo(s,this.#d[t].top),this.#C[t].ellipse(s,o,this.#M.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"AND":case"NAND":this.#C[t].lineTo(this.#d[t].left,this.#d[t].top),this.#C[t].lineTo(s,this.#d[t].top),this.#C[t].ellipse(s,o,this.#M.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":this.#C[t].ellipse(this.#d[t].left,o,this.#M.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#C[t].lineTo(s,this.#d[t].top),this.#C[t].ellipse(s,o,this.#M.radiusLeft,n,0,-Math.PI/2,Math.PI/2);var h=new Path2D;h.ellipse(this.#d[t].left-this.#M.xorGap,o,this.#M.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#C[t].addPath(h);break;case"NOT":this.#C[t].moveTo(this.#d[t].left,this.#d[t].top),this.#C[t].lineTo(s,o),this.#C[t].lineTo(this.#d[t].left,i),this.#C[t].closePath();break}this.#b.stroke(this.#C[t])}#ht(t,e){if(this.#P.showOperatorType){var s;switch(this.#b.font=this.#M.font,e){case"OR":case"XOR":s=this.#M.radiusLeft+(this.#N[t].width-this.#M.radiusLeft-this.#b.measureText(e).width)/2;break;case"AND":s=(this.#N[t].width-this.#b.measureText(e).width)/2;break;case"NOR":case"NXOR":s=this.#M.radiusLeft+(this.#N[t].width-this.#M.radiusLeft-this.#b.measureText(e).width)/2-this.#M.notRadius;break;case"NAND":s=(this.#N[t].width-this.#b.measureText(e).width)/2-this.#M.notRadius;break;case"NOT":s=(this.#N[t].width-this.#b.measureText(e).width)/4;break}this.#b.fillText(e,this.#d[t].left+s,this.#d[t].top+this.#N[t].height/2),this.#b.font=this.#P.font}}#et(t){this.#x[t]=new Path2D,this.#x[t].moveTo(this.#y[t].left,this.#y[t].top-this.#j.radius),this.#x[t].lineTo(this.#y[t].left+this.#j.radius,this.#y[t].top),this.#x[t].lineTo(this.#y[t].left,this.#y[t].top+this.#j.radius),this.#x[t].lineTo(this.#y[t].left-this.#j.radius,this.#y[t].top),this.#x[t].closePath(),this.#b.stroke(this.#x[t])}#$(t,e,s){if(t){if(this.#O[e+"*"+s]=new Path2D,this.#O[e+"*"+s].moveTo(this.#y[t+"*exit"].left,this.#y[t+"*exit"].top),this.#P.bezierConnector){var i={left:this.#y[t+"*exit"].left+(this.#y[e+"*"+s].left-this.#y[t+"*exit"].left)/2,top:this.#y[t+"*exit"].top},o={left:i.left,top:this.#y[e+"*"+s].top};this.#O[e+"*"+s].bezierCurveTo(i.left,i.top,o.left,o.top,this.#y[e+"*"+s].left,this.#y[e+"*"+s].top)}else this.#O[e+"*"+s].lineTo(this.#y[e+"*"+s].left,this.#y[e+"*"+s].top);this.#b.stroke(this.#O[e+"*"+s])}}#Q(){if(this.#U.name){var t=this.#l.getType(this.#U.name);"symbolPath"!==this.#U.referencePath||(this.#P.interactive&&"IN"===t?(this.#R.selected=this.#b.isPointInPath(this.#I[this.#U.name],this.#v.offsetX,this.#v.offsetY),this.#p.style.cursor=this.#R.selected?this.#w.pointer:this.#w.grab):["IN","OUT","NOT"].includes(t)?this.#p.style.cursor=this.#w.grab:this.#at()),this.#rt()}else;}#at(){var t=this.#d[this.#U.name].left+3*this.#N[this.#U.name].width/5;switch(this.#l.getType(this.#U.name)){case"OR":case"AND":case"XOR":break;case"NOR":case"NAND":case"NXOR":t-=this.#M.notRadius;break}var e=this.#l.getFrom(this.#U.name).length,s=this.#d[this.#U.name].top+this.#N[this.#U.name].height/4,i=this.#d[this.#U.name].top+3*this.#N[this.#U.name].height/4;this.#b.font=this.#L.font;var o=this.#b.measureText(this.#L.up).width,n=this.#b.measureText(this.#L.down).width,h=Math.max(o,n),a=new Path2D,r=new Path2D;this.#b.fillStyle=e>2?this.#L.canDoStrokeStyle:this.#L.cannotDoStrokeStyle,r.rect(t-2,this.#d[this.#U.name].top+3,h+4,this.#N[this.#U.name].height/2-3),a.addPath(r),this.#b.fill(r),this.#b.stroke(r),r=new Path2D,this.#b.fillStyle=e<this.#L.max?this.#L.canDoStrokeStyle:this.#L.cannotDoStrokeStyle,r.rect(t-2,this.#d[this.#U.name].top+this.#N[this.#U.name].height/2,h+4,this.#N[this.#U.name].height/2-3),a.addPath(r),this.#b.fill(r),this.#b.stroke(r),this.#b.fillStyle=this.#P.strokeStyle,this.#b.fillText(this.#L.up,t+(h-o)/2,s),this.#b.fillText(this.#L.down,t+(h-n)/2,i),this.#b.font=this.#P.font,this.#L.selected=this.#b.isPointInPath(a,this.#v.offsetX,this.#v.offsetY),this.#L.name=this.#U.name,this.#L.direction=this.#v.offsetY<this.#d[this.#U.name].top+this.#N[this.#U.name].height/2?"UP":"DOWN",this.#L.selected?"UP"===this.#L.direction&&e>2||"DOWN"===this.#L.direction&&e<this.#L.max?this.#p.style.cursor=this.#w.pointer:this.#p.style.cursor=this.#w.notAllowed:this.#p.style.cursor=this.#w.grab}#rt(){this.#b.lineWidth=this.#U.lineWidth,this.#E.pressed?(this.#p.style.cursor=this.#w.grabbing,this.#b.strokeStyle=this.#ct(this.#p.width,this.#p.height,this.#k.lineWidth,this.#d[this.#U.name].left,this.#d[this.#U.name].top,this.#N[this.#U.name].width,this.#N[this.#U.name].height)?this.#k.strokeStyle:this.#U.strokeStyle):this.#b.strokeStyle="connectorPath"===this.#U.referencePath?this.#k.strokeStyle:this.#U.strokeStyle,this.#b.stroke(this.#lt(this.#U.referencePath,this.#U.referenceName)),this.#b.lineWidth=this.#P.lineWidth,this.#b.strokeStyle=this.#P.strokeStyle}#tt(){if(this.#j.pressed){if(this.#b.beginPath(),this.#b.moveTo(this.#j.event.offsetX,this.#j.event.offsetY),this.#P.bezierConnector){var t={left:this.#j.event.offsetX+(this.#v.offsetX-this.#j.event.offsetX)/2,top:this.#j.event.offsetY},e={left:t.left,top:this.#v.offsetY};this.#b.bezierCurveTo(t.left,t.top,e.left,e.top,this.#v.offsetX,this.#v.offsetY)}else this.#b.lineTo(this.#v.offsetX,this.#v.offsetY);this.#b.stroke(),this.#j.name&&(this.#b.lineWidth=this.#j.lineWidth,this.#b.strokeStyle=this.#dt(this.#U.name,this.#U.index,this.#j.name,this.#j.index)?this.#j.canDoStrokeStyle:this.#j.cannotDoStrokeStyle,this.#b.stroke(this.#x[this.#j.referenceName]),this.#b.lineWidth=this.#P.lineWidth,this.#b.strokeStyle=this.#P.strokeStyle)}}#ct(t,e,s,i,o,n,h){var a=t,r=e;t<i?a=i:t>i+n&&(a=i+n),e<o?r=o:e>o+h&&(r=o+h);var c=t-a,l=e-r;return Math.sqrt(c*c+l*l)<=s}#lt(t,e){switch(t){case"symbolPath":return this.#C[e];case"knobPath":return this.#x[e];case"connectorPath":return this.#O[e]}}#dt(t,e,s,i){var o=this.#l.getType(t),n=this.#l.getType(s);return("IN"!==o||"IN"!==n)&&("IN"===o&&"OUT"===n?this.#l.isConnectionValid(t,s):"IN"===o?-1!==i&&this.#l.isConnectionValid(t,s):"OUT"===o&&"IN"===n?this.#l.isConnectionValid(s,t):("OUT"!==o||"OUT"!==n)&&("OUT"===o?-1===i&&this.#l.isConnectionValid(s,t):"IN"===n?-1!==e&&this.#l.isConnectionValid(s,t):"OUT"===n?-1===e&&this.#l.isConnectionValid(t,s):(-1!==e||-1!==i)&&((-1===e||-1===i)&&(-1===e?this.#l.isConnectionValid(t,s):-1===i&&this.#l.isConnectionValid(s,t)))))}#W(t){this.#v=t;var e=Math.sqrt(Math.pow(t.offsetX-this.#p.width,2)+Math.pow(t.offsetY-this.#p.height,2));this.#p.setAttribute("title",e<this.#k.radius2?"To trash an element move and release it here":""),this.#E.pressed?(this.#d[this.#U.name].top=t.offsetY-this.#E.offsetTop,this.#d[this.#U.name].left=t.offsetX-this.#E.offsetLeft,this.#g.forEach((t=>t()))):this.#j.pressed?this.#ut(t):this.#ft(t),this.#Y()}#ut(t){for(var e in this.#j.name="",this.#d)switch(this.#l.getType(e)){case"IN":!this.#j.name&&this.#b.isPointInPath(this.#x[e+"*exit"],t.offsetX,t.offsetY)&&(this.#j.name=e,this.#j.index=-1,this.#j.referenceName=e+"*exit");break;case"OUT":this.#l.getFrom(e).forEach(((s,i)=>{!this.#j.name&&this.#b.isPointInPath(this.#x[e+"*"+i],t.offsetX,t.offsetY)&&(this.#j.name=e,this.#j.index=i,this.#j.referenceName=e+"*"+i)}));break;default:!this.#j.name&&this.#b.isPointInPath(this.#x[e+"*exit"],t.offsetX,t.offsetY)&&(this.#j.name=e,this.#j.index=-1,this.#j.referenceName=e+"*exit"),this.#l.getFrom(e).forEach(((s,i)=>{!this.#j.name&&this.#b.isPointInPath(this.#x[e+"*"+i],t.offsetX,t.offsetY)&&(this.#j.name=e,this.#j.index=i,this.#j.referenceName=e+"*"+i)}));break}}#ft(t){for(var e in this.#U.name="",this.#d){switch(this.#l.getType(e)){case"IN":!this.#U.name&&this.#b.isPointInPath(this.#x[e+"*exit"],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=-1,this.#U.referencePath="knobPath",this.#U.referenceName=e+"*exit");break;case"OUT":!this.#U.name&&this.#b.isPointInPath(this.#x[e+"*0"],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=0,this.#U.referencePath="knobPath",this.#U.referenceName=e+"*0"),!this.#U.name&&this.#l.getFrom(e)[0]&&this.#b.isPointInStroke(this.#O[e+"*0"],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=0,this.#U.referencePath="connectorPath",this.#U.referenceName=e+"*0");break;default:!this.#U.name&&this.#b.isPointInPath(this.#x[e+"*exit"],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=-1,this.#U.referencePath="knobPath",this.#U.referenceName=e+"*exit"),this.#l.getFrom(e).forEach(((s,i)=>{!this.#U.name&&this.#b.isPointInPath(this.#x[e+"*"+i],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=i,this.#U.referencePath="knobPath",this.#U.referenceName=e+"*"+i),!this.#U.name&&s&&this.#b.isPointInStroke(this.#O[e+"*"+i],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.index=i,this.#U.referencePath="connectorPath",this.#U.referenceName=e+"*"+i)}));break}!this.#U.name&&this.#b.isPointInPath(this.#C[e],t.offsetX,t.offsetY)&&(this.#U.name=e,this.#U.referencePath="symbolPath",this.#U.referenceName=e)}}#z(t){if(this.#U.name)switch(this.#U.referencePath){case"knobPath":this.#j.pressed=!0,this.#j.event=t;break;case"symbolPath":if(this.#L.selected){var e=this.#l.getFrom(this.#L.name).length;switch(this.#L.direction){case"UP":e>2&&(this.#l.decConnector(this.#L.name),this.#d[this.#L.name].top+=this.#M.oneHeight/2,this.#m.forEach((t=>t())),this.#g.forEach((t=>t())));break;case"DOWN":e<this.#L.max&&(this.#l.incConnector(this.#L.name),this.#d[this.#L.name].top-=this.#M.oneHeight/2,this.#m.forEach((t=>t())),this.#g.forEach((t=>t())));break}this.#Y()}else this.#R.selected?(this.#u[this.#U.name]=!this.#u[this.#U.name],this.#Y()):(this.#E.pressed=!0,this.#E.offsetLeft=t.offsetX-this.#d[this.#U.name].left,this.#E.offsetTop=t.offsetY-this.#d[this.#U.name].top,this.#p.style.cursor=this.#w.grabbing);break;case"connectorPath":this.#l.removeConnection(this.#U.name,this.#U.index),this.#U.name="",this.#m.forEach((t=>t())),this.#g.forEach((t=>t())),this.#Y();break}}#F(t){if(this.#U.name&&this.#E.pressed&&this.#ct(this.#p.width,this.#p.height,this.#k.lineWidth,this.#d[this.#U.name].left,this.#d[this.#U.name].top,this.#N[this.#U.name].width,this.#N[this.#U.name].height))this.#l.remove(this.#U.name),delete this.#d[this.#U.name],this.#U.name="",this.#m.forEach((t=>t())),this.#g.forEach((t=>t()));else if(this.#j.pressed&&this.#j.name&&this.#dt(this.#U.name,this.#U.index,this.#j.name,this.#j.index)){var e=this.#l.getType(this.#U.name),s=this.#l.getType(this.#j.name);"IN"===e?this.#l.addConnection(this.#U.name,this.#j.name,this.#j.index):"IN"===s?this.#l.addConnection(this.#j.name,this.#U.name,this.#U.index):"OUT"===e?this.#l.addConnection(this.#j.name,this.#U.name,0):"OUT"===s?this.#l.addConnection(this.#U.name,this.#j.name,0):-1===this.#U.index?this.#l.addConnection(this.#U.name,this.#j.name,this.#j.index):-1===this.#j.index&&this.#l.addConnection(this.#j.name,this.#U.name,this.#U.index),this.#m.forEach((t=>t())),this.#g.forEach((t=>t()))}this.#j.pressed=!1,this.#E.pressed=!1,this.#L.selected=!1,this.#Y()}}
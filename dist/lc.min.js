class LogicalCircuit{#t={};#e=["OR","NOR","AND","NAND","XOR","NXOR","NOT","BREAK","CASE","CATCH","CLASS","CONST","CONTINUE","DEBUGGER","DEFAULT","DELETE","DO","ELSE","EXPORT","EXTENDS","FALSE","FINALLY","FOR","FUNCTION","IF","IMPORT","IN","INSTANCEOF","NEW","NULL","RETURN","SUPER","SWITCH","THIS","THROW","TRUE","TRY","TYPEOF","VAR","VOID","WHILE","WITH","LET","STATIC","YIELD","AWAIT","ENUM","IMPLEMENTS","INTERFACE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","ABSTRACT","BOOLEAN","BYTE","CHAR","DOUBLE","FINAL","FLOAT","GOTO","INT","LONG","NATIVE","SHORT","SYNCHRONIZED","THROWS","TRANSIENT","VOLATILE","ARGUMENTS","AS","ASYNC","EVAL","FROM","GET","OF","SET"];#i=["OR","NOR","AND","NAND","XOR","NXOR","NOT"];#s={OR:"||",AND:"&&",XOR:"+",NOR:"||",NAND:"&&",NXOR:"+"};#o={OR:"",AND:"",XOR:"===1",NOR:"",NAND:"",NXOR:"!==1"};constructor(){}setJSON(t){this.#t=JSON.parse(JSON.stringify(t))}getJSON(){return JSON.parse(JSON.stringify(this.#t))}simplify(){if(this.isValid()){var t=Object.keys(this.#t).filter((t=>"IN"===this.#t[t].type)),e={},i=!0;return t.forEach((t=>e[t]={type:"IN"})),Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((s=>{var o=this.#n(s,t),n=this.#h(o),h=this.#a(o,n),a=this.#r(n,h);e[s]={type:"OUT",from:[this.#c(e,t,a)]},i&=this.#l(s,e,t)})),i&&(this.#t=e),!!i}return!1}#n(t,e){for(var i={},s=0;s<Math.pow(2,e.length);s++){var o={},n=s.toString(2).padStart(e.length,"0");e.forEach(((t,e)=>o[t]=!!parseInt(n[e]))),this.computeExpression(t,o)&&(i[""+s]=n)}return i}#h(t){var e={},i=!1;return Object.keys(t).forEach((s=>{var o=!1;Object.keys(t).forEach((n=>{for(var h=0,a=t[s],r=0;r<a.length;r++)a[r]!==t[n][r]&&(a=a.substring(0,r)+"-"+a.substring(r+1),h++);1===h&&(o=!0,i=!0,Object.keys(e).some((t=>e[t]===a))||(e[s+","+n]=a))})),o||(e[s]=t[s])})),i?this.#h(e):e}#a(t,e){var i={};return Object.keys(t).forEach((t=>i[t]=Object.keys(e).flatMap((t=>t.split(","))).filter((e=>e===t)).length)),i}#r(t,e){for(var i={},s=!0;s;)s=!1,Object.keys(e).filter((t=>1===e[t])).forEach((o=>{s=!0,delete e[o],Object.keys(t).filter((t=>t.split(",").includes(o))).forEach((e=>{i[e]=t[e],delete t[e]}))}));return i}#c(t,e,i){var s=this.#d();return t[s]={type:"OR",from:[]},Object.keys(i).forEach((o=>{var n=i[o].split("");if(1===n.filter((t=>"-"!==t)).length)this.#u(t,s,e,n);else{var h=this.#d();t[h]={type:"AND",from:[]},this.#u(t,h,e,n),t[s].from.push(h)}})),s}#u(t,e,i,s){for(var o=0;o<s.length;o++)switch(s[o]){case"0":var n=this.#d();t[n]={type:"NOT",from:[i[o]]},t[e].from.push(n);break;case"1":t[e].from.push(i[o]);break;case"-":break}}#l(t,e,i){for(var s=this.#t,o=!0,n=0;n<Math.pow(2,i.length);n++){var h={},a=n.toString(2).padStart(i.length,"0");i.forEach(((t,e)=>h[t]=!!parseInt(a[e])));var r=this.computeExpression(t,h);this.#t=e;var c=this.computeExpression(t,h);this.#t=s,o&=r===c}return!!o}computeExpressions(t){var e={};return this.isValid()&&Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((i=>e[i]=this.computeExpression(i,t))),e}computeExpression(name,parameters){var result;if(this.isValid()&&this.#t[name]&&"OUT"===this.#t[name].type){var toEval="";for(var property in parameters)toEval+="var "+property+" = "+parameters[property]+";\n";toEval+="result = "+this.getJavaScriptExpression(name)+";",eval(toEval)}return result}getJavaScriptExpressions(){var t={};return this.isValid()&&Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t[e]=this.#f(this.#t[e].from[0],!1))),t}getJavaScriptExpression(t){return this.isValid()&&this.#t[t]&&"OUT"===this.#t[t].type?this.#f(this.#t[t].from[0],!1):""}#f(t,e){if("IN"===this.#t[t].type)return t;if("NOT"===this.#t[t].type)return"!"+this.#f(this.#t[t].from[0],!0);var i=this.#t[t].from.map((t=>this.#f(t,!0)));switch(this.#t[t].type){case"OR":case"AND":case"XOR":case"NXOR":return(e?"(":"")+i.join(this.#s[this.#t[t].type])+this.#o[this.#t[t].type]+(e?")":"");case"NOR":case"NAND":return"!("+i.join(this.#s[this.#t[t].type])+")"}}isValid(){var t=!0;return Object.keys(this.#t).filter((t=>"OUT"===this.#t[t].type)).forEach((e=>t&=this.#p(e))),!!t}#p(t){var e=!0;return this.#t[t].from.forEach((t=>{(e&=!!t)&&"IN"!==this.#t[t].type&&(e&=!!this.#p(t))})),!!e}addInput(t){return this.#m(t,{type:"IN"})}addOutput(t){return this.#m(t,{type:"OUT",from:[""]})}addOR(){return this.#b("OR",["",""])}addNOR(){return this.#b("NOR",["",""])}addAND(){return this.#b("AND",["",""])}addNAND(){return this.#b("NAND",["",""])}addXOR(){return this.#b("XOR",["",""])}addNXOR(){return this.#b("NXOR",["",""])}addNOT(){return this.#b("NOT",[""])}#b(t,e){var i=this.#d();return this.#m(i,{type:t,from:e}),i}#m(t,e){return!(!this.isNameValid(t)||this.isNameAlreadyUsed(t))&&(this.#t[t]=e,!0)}#d(){return"LogicalCircuit_Operator_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random())}incConnector(t){this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.push("")}decConnector(t){if(this.#t[t]&&"OUT"!==this.#t[t].type&&"NOT"!==this.#t[t].type&&this.#t[t].from&&this.#t[t].from.length>2){var e=this.#t[t].from.indexOf("");-1!==e?this.#t[t].from.splice(e,1):this.#t[t].from.pop()}}addConnection(t,e,i){this.isConnectionValid(t,e)&&0<=i&&i<this.#t[e].from.length&&(this.#t[e].from[i]=t)}isConnectionValid(t,e){return!(t===e||!this.#t[t]||!this.#t[e])&&("IN"===this.#t[t].type?"IN"!==this.#t[e].type:"OUT"!==this.#t[t].type&&("IN"!==this.#t[e].type&&("OUT"===this.#t[e].type||!this.#g(t,e))))}#g(t,e){var i=Object.keys(this.#t).filter((t=>this.#i.includes(this.#t[t].type)&&this.#t[t].from.includes(e)));if(i.includes(t))return!0;var s=!1;return i.forEach((e=>s|=this.#g(t,e))),s}removeConnection(t,e){this.#t[t]&&0<=e&&e<this.#t[t].from.length&&(this.#t[t].from[e]="")}remove(t){if(this.#t[t])for(var e in delete this.#t[t],this.#t)switch(this.#t[e].type){case"IN":break;case"OUT":default:this.#t[e].from=this.#t[e].from.map((e=>e===t?"":e));break}}clear(){this.#t={}}getType(t){return this.#t[t]?this.#t[t].type:""}getFrom(t){if(!this.#t[t])return[];switch(this.#t[t].type){case"IN":return[];case"OUT":default:return this.#t[t].from.slice()}}isNameValid(t){return"string"==typeof t&&(/^[a-z]+[a-z0-9_]*$/i.test(t)&&!this.#e.includes(t.toUpperCase()))}isNameAlreadyUsed(t){return!!this.#t[t]}addBlackListWord(t){t&&this.#e.push(t.toUpperCase())}}class LogicalCircuitUI{#y=new LogicalCircuit;#x={};#C={};#O;#v;#N;#I=[];#P=[];#T={};#w={};#k={};#S={};#j={};#E={};#U;#M={width:800,height:600,font:"24px sans-serif",lineWidth:2,strokeStyle:"black",cursor:"default",bezierConnector:!1,showOperatorType:!1,interactive:!1};#L={grab:"grab",pointer:"pointer",notAllowed:"not-allowed",grabbing:"grabbing"};#R={top:15,left:15};#A={font:"48px sans-serif",text:"ðŸ—‘",strokeStyle:"red",left:35,top:20,lineWidth:80,radius1:40,radius2:120,gradients:[{pos:0,color:"rgba(0,0,0,0)"},{pos:.5,color:"rgba(0,0,0,0)"},{pos:1,color:"rgba(0,0,0,0.3)"}]};#K={gap:20,height:40,ONStyle:"green",OFFStyle:"gray",circleStyle:"white"};#D={radiusLeft:20,lineWidth:30,oneHeight:20,xorGap:12,notRadius:7,font:"9px sans-serif"};#X={name:"",index:-1,referencePath:"",referenceName:"",lineWidth:3,strokeStyle:"green"};#W={pressed:!1,name:"",index:-1,referenceName:"",event:null,canDoStrokeStyle:"green",cannotDoStrokeStyle:"orange",lineWidth:3,radius:5};#z={pressed:!1,name:"",offsetLeft:0,offsetTop:0};#F={selected:!1,name:"",direction:"",font:"14px sans-serif",up:"-",down:"+",max:6,canDoStrokeStyle:"white",cannotDoStrokeStyle:"gray"};#V={selected:!1};constructor(t,e){try{e.width}catch(t){e={}}e.width=isNaN(e.width)||e.width<0?this.#M.width:e.width,e.height=isNaN(e.height)||e.height<0?this.#M.height:e.height,this.#O="LogicalCircuitUI_Container_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),t.classList.add("LogicalCircuitUI_Container"),t.classList.add(this.#O),t.style.width=e.width+2+"px";var i=document.createElement("div");i.classList.add("LogicalCircuitUI_Toolbar"),i.style.width=e.width+2+"px",t.append(i);var s=document.createElement("div");s.classList.add("LogicalCircuitUI_Toolbar_Left"),i.append(s);var o=document.createElement("div");o.classList.add("LogicalCircuitUI_Toolbar_Center"),i.append(o);var n=document.createElement("div");n.classList.add("LogicalCircuitUI_Toolbar_Right"),i.append(n),this.#Y(s),this.#B(s,"OR",(()=>this.#m("OR")),(()=>this.#m("NOR"))),this.#B(s,"AND",(()=>this.#m("AND")),(()=>this.#m("NAND"))),this.#B(s,"XOR",(()=>this.#m("XOR")),(()=>this.#m("NXOR"))),this.#B(s,"NOT",(()=>this.#m("NOT"))),this.#B(o,"SIMPLIFY",(()=>this.#J()));try{new dagre.graphlib.Graph;this.#B(o,"TIDY UP",(()=>this.#H(!1)))}catch(t){}this.#B(n,"CLEAR",(()=>this.#_())),this.#v=document.createElement("canvas"),this.#v.classList.add("LogicalCircuitUI_Canvas"),this.#v.width=e.width,this.#v.height=e.height,this.#v.onmousemove=t=>this.#q(t),this.#v.onmousedown=t=>this.#G(t),this.#v.onmouseup=t=>this.#Z(t),t.append(this.#v),this.#N=this.#v.getContext("2d"),this.#N.font=this.#M.font,this.#N.textBaseline="middle",this.#N.lineWidth=this.#M.lineWidth,this.#N.lineJoin="round",this.#$(),e.bezierConnector&&this.setBezierConnector(!0),e.showOperatorType&&this.setShowOperatorType(!0),e.interactive&&this.setInteractive(!0)}setJSONs(t,e){this.#y.setJSON(t),this.#x=JSON.parse(JSON.stringify(e)),this.setInteractive(this.#M.interactive),this.#Q(),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$()}getJSON(){return this.#y.getJSON()}getJSONUI(){return JSON.parse(JSON.stringify(this.#x))}computeExpressions(t){return this.#y.computeExpressions(t)}computeExpression(t,e){return this.#y.computeExpression(t,e)}getJavaScriptExpressions(){return this.#y.getJavaScriptExpressions()}getJavaScriptExpression(t){return this.#y.getJavaScriptExpression(t)}isValid(){return this.#y.isValid()}#Y(t){var e=document.createElement("div");e.classList.add("LogicalCircuitUI_TextContainer"),t.append(e);var i=document.createElement("input");i.type="text",i.classList.add("IN-OUT"),i.oninput=t=>{var e=!this.#y.isNameValid(i.value)||this.#y.isNameAlreadyUsed(i.value);s.disabled=e,o.disabled=e},e.append(i);var s=this.#tt(e,"IN",!0),o=this.#tt(e,"OUT",!0);s.onclick=t=>this.#et(i.value),o.onclick=t=>this.#it(i.value)}#B(t,e,i,s){var o=document.createElement("div");o.classList.add("LogicalCircuitUI_ButtonContainer"),t.append(o),i&&(this.#tt(o,e,!1).onclick=t=>i(e)),s&&(this.#tt(o,"N"+e,!1).onclick=t=>s(e))}#tt(t,e,i){var s=document.createElement("button");return s.textContent=e,s.classList.add(e.replace(" ","-")),s.disabled=i,t.append(s),s}#et(t){this.#y.addInput(t)&&(this.#st(t),this.#M.interactive&&(this.#C[t]=!1),this.#Q(),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$())}#it(t){this.#y.addOutput(t)&&(this.#st(t),this.#Q(),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$())}#m(t){var e=this.#y["add"+t]();this.#st(e),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$()}#st(t){this.#x[t]={top:this.#R.top,left:this.#R.left}}#J(){if(confirm("Do you really want to simplify the current logical circuit?")&&this.#y.simplify()){this.#x={},this.#Q();try{new dagre.graphlib.Graph;Object.keys(this.getJSON()).forEach((t=>this.#st(t))),this.setInteractive(this.#M.interactive),this.#I.forEach((t=>t())),this.#H(!0)}catch(e){var t=this.getJSON();Object.keys(t).filter((t=>"IN"===this.#y.getType(t))).forEach(((t,e,i)=>this.#ot(t,e,i,this.#R.left))),Object.keys(t).filter((t=>"NOT"===this.#y.getType(t))).forEach(((t,e,i)=>this.#ot(t,e,i,this.#v.width/5))),Object.keys(t).filter((t=>"AND"===this.#y.getType(t))).forEach(((t,e,i)=>this.#ot(t,e,i,2*this.#v.width/5))),Object.keys(t).filter((t=>"OR"===this.#y.getType(t))).forEach(((t,e,i)=>this.#ot(t,e,i,3*this.#v.width/5))),Object.keys(t).filter((t=>"OUT"===this.#y.getType(t))).forEach(((t,e,i)=>this.#ot(t,e,i,4*this.#v.width/5))),this.setInteractive(this.#M.interactive),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$()}}}#ot(t,e,i,s){this.#x[t]={top:(e+1)*this.#v.height/(i.length+1)-this.#K.height,left:s}}#H(t){if(t||confirm("Do you really want to tidy up the current logical circuit?")){var e=new dagre.graphlib.Graph;for(var i in e.setGraph({rankdir:"LR",marginx:20,marginy:20}),e.setDefaultEdgeLabel((()=>({}))),this.#x)switch(e.setNode(i,{width:this.#S[i].width,height:this.#S[i].height}),this.#y.getType(i)){case"IN":break;case"OUT":e.setEdge(this.#y.getFrom(i)[0],i);break;default:this.#y.getFrom(i).forEach((t=>e.setEdge(t,i)));break}dagre.layout(e);var s=e.graph(),o=s.width>this.#v.width||s.height>this.#v.height?Math.min(this.#v.width/s.width,this.#v.height,s.height):1;e.nodes().forEach((t=>{var i=e.node(t);this.#x[t].left=i.x*o-i.width/2,this.#x[t].top=i.y*o-i.height/2})),this.#P.forEach((t=>t())),this.#$()}}#_(){confirm("Do you really want to clear the current logical circuit?")&&(this.#y.clear(),this.#x={},this.#Q(),this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$())}#Q(){document.querySelector("."+this.#O+" input.IN-OUT").value="",document.querySelector("."+this.#O+" button.IN").disabled=!0,document.querySelector("."+this.#O+" button.OUT").disabled=!0}setBezierConnector(t){this.#M.bezierConnector=!!t,this.#$()}setShowOperatorType(t){this.#M.showOperatorType=!!t,this.#$()}setInteractive(t){if(this.#M.interactive=!!t,this.#V.selected=!1,this.#C={},t)for(var e in this.#x)"IN"===this.#y.getType(e)&&(this.#C[e]=!1);this.#$()}addOnChangeListener(t){this.#I.push(t)}addOnChangeUIListener(t){this.#P.push(t)}addBlackListWord(t){this.#y.addBlackListWord(t)}#$(){for(var t in this.#v.style.cursor=this.#M.cursor,this.#N.clearRect(0,0,this.#v.width,this.#v.height),this.#nt(),this.#x){switch(e=this.#y.getType(t)){case"IN":this.#ht(t,"exit");break;case"OUT":this.#ht(t,"0");break;default:this.#at(t,e);break}}for(var t in this.#x){var e;switch(e=this.#y.getType(t)){case"IN":break;case"OUT":this.#rt(this.#y.getFrom(t)[0],t,0);break;default:this.#y.getFrom(t).forEach(((e,i)=>this.#rt(e,t,i)));break}}this.#ct(),this.#lt()}#nt(){this.#N.font=this.#A.font,this.#N.fillText(this.#A.text,this.#v.width-this.#A.left,this.#v.height-this.#A.top),this.#N.font=this.#M.font;var t=this.#N.createRadialGradient(this.#v.width,this.#v.height,this.#A.radius1,this.#v.width,this.#v.height,this.#A.radius2);this.#A.gradients.forEach((e=>t.addColorStop(e.pos,e.color))),this.#N.lineWidth=this.#A.lineWidth,this.#N.strokeStyle=t,this.#N.beginPath(),this.#N.arc(this.#v.width,this.#v.height,this.#A.lineWidth,0,2*Math.PI),this.#N.stroke(),this.#N.lineWidth=this.#M.lineWidth,this.#N.strokeStyle=this.#M.strokeStyle}#ht(t,e){var i=this.#N.measureText(t).width+this.#K.gap+(this.#M.interactive?this.#K.gap:0),s=this.#x[t].top+this.#K.height/2;if(this.#w[t+"*"+e]={left:this.#x[t].left+("exit"===e?i+this.#W.radius:-this.#W.radius),top:s},this.#dt(t+"*"+e),this.#S[t]={width:i,height:this.#K.height},this.#k[t]=new Path2D,this.#k[t].rect(this.#x[t].left,this.#x[t].top,i,this.#K.height),this.#N.stroke(this.#k[t]),this.#M.interactive){var o;o="exit"===e?this.#C[t]?this.#K.ONStyle:this.#K.OFFStyle:this.isValid()?this.computeExpression(t,this.#C)?this.#K.ONStyle:this.#K.OFFStyle:this.#K.circleStyle;var n=this.#K.gap/2-2,h=o===this.#K.ONStyle?this.#x[t].top+2+n+2:this.#x[t].top+this.#K.height-2-n-2,a=new Path2D;a.roundRect(this.#x[t].left+i-this.#K.gap-2,this.#x[t].top+2,this.#K.gap,this.#K.height-4,this.#K.gap/2),"exit"===e&&(this.#E[t]=a),this.#N.fillStyle=o,this.#N.fill(a),this.#N.fillStyle=this.#K.circleStyle,this.#N.beginPath(),this.#N.arc(this.#x[t].left+i-this.#K.gap/2-2,h,n,0,2*Math.PI),this.#N.fill(),this.#N.fillStyle=this.#M.strokeStyle}this.#N.fillText(t,this.#x[t].left+this.#K.gap/2,this.#w[t+"*"+e].top)}#at(t,e){this.#k[t]=new Path2D;var i=this.#y.getFrom(t),s=this.#D.oneHeight*i.length/2,o=this.#x[t].left+this.#D.lineWidth+("NOT"===e?this.#D.radiusLeft:0),n=this.#x[t].top+this.#D.oneHeight*("NOT"===e?2:i.length),h=this.#x[t].top+("NOT"===e?this.#D.oneHeight:s);this.#ut(t,e,o,h),this.#ft(t,e,i,h,s),this.#pt(t,e,i,o,h),this.#mt(t,e,o,n,h,s),this.#bt(t,e)}#ut(t,e,i,s){switch(e){case"OR":case"AND":case"XOR":this.#w[t+"*exit"]={left:i+this.#D.radiusLeft+this.#W.radius,top:s};break;case"NOR":case"NAND":case"NXOR":this.#w[t+"*exit"]={left:i+this.#D.radiusLeft+2*this.#D.notRadius+this.#W.radius,top:s};break;case"NOT":this.#w[t+"*exit"]={left:i+2*this.#D.notRadius+this.#W.radius,top:s};break}this.#dt(t+"*exit")}#ft(t,e,i,s,o){for(var n=Math.PI/(i.length+1),h=0;h<i.length;h++){switch(e){case"OR":case"NOR":var a=n*(h+1)-Math.PI/2;this.#w[t+"*"+h]={left:this.#x[t].left+(this.#D.radiusLeft-this.#W.radius)*Math.cos(a),top:s+(o-this.#W.radius)*Math.sin(a)};break;case"AND":case"NAND":this.#w[t+"*"+h]={left:this.#x[t].left-this.#W.radius,top:this.#x[t].top+this.#D.oneHeight/2+this.#D.oneHeight*h};break;case"XOR":case"NXOR":a=n*(h+1)-Math.PI/2;this.#w[t+"*"+h]={left:this.#x[t].left+(this.#D.radiusLeft-this.#W.radius)*Math.cos(a)-this.#D.xorGap,top:s+(o-this.#W.radius)*Math.sin(a)};break;case"NOT":this.#w[t+"*"+h]={left:this.#x[t].left-this.#W.radius,top:s};break}this.#dt(t+"*"+h)}}#pt(t,e,i,s,o){switch(e){case"OR":case"AND":case"XOR":this.#S[t]={width:this.#D.lineWidth+this.#D.radiusLeft,height:this.#D.oneHeight*i.length};break;case"NOR":case"NAND":case"NXOR":(n=new Path2D).arc(s+this.#D.radiusLeft+this.#D.notRadius,o,this.#D.notRadius,0,2*Math.PI),this.#k[t].addPath(n),this.#S[t]={width:this.#D.lineWidth+this.#D.radiusLeft+2*this.#D.notRadius,height:this.#D.oneHeight*i.length};break;case"NOT":var n;(n=new Path2D).arc(s+this.#D.notRadius,o,this.#D.notRadius,0,2*Math.PI),this.#k[t].addPath(n),this.#S[t]={width:this.#D.lineWidth+this.#D.radiusLeft+2*this.#D.notRadius,height:2*this.#D.oneHeight};break}}#mt(t,e,i,s,o,n){switch("NOT"!==e&&(this.#k[t].moveTo(i,s),this.#k[t].lineTo(this.#x[t].left,s)),e){case"OR":case"NOR":this.#k[t].ellipse(this.#x[t].left,o,this.#D.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#k[t].lineTo(i,this.#x[t].top),this.#k[t].ellipse(i,o,this.#D.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"AND":case"NAND":this.#k[t].lineTo(this.#x[t].left,this.#x[t].top),this.#k[t].lineTo(i,this.#x[t].top),this.#k[t].ellipse(i,o,this.#D.radiusLeft,n,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":this.#k[t].ellipse(this.#x[t].left,o,this.#D.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#k[t].lineTo(i,this.#x[t].top),this.#k[t].ellipse(i,o,this.#D.radiusLeft,n,0,-Math.PI/2,Math.PI/2);var h=new Path2D;h.ellipse(this.#x[t].left-this.#D.xorGap,o,this.#D.radiusLeft,n,0,Math.PI/2,-Math.PI/2,!0),this.#k[t].addPath(h);break;case"NOT":this.#k[t].moveTo(this.#x[t].left,this.#x[t].top),this.#k[t].lineTo(i,o),this.#k[t].lineTo(this.#x[t].left,s),this.#k[t].closePath();break}this.#N.stroke(this.#k[t])}#bt(t,e){if(this.#M.showOperatorType){var i;switch(this.#N.font=this.#D.font,e){case"OR":case"XOR":i=this.#D.radiusLeft+(this.#S[t].width-this.#D.radiusLeft-this.#N.measureText(e).width)/2;break;case"AND":i=(this.#S[t].width-this.#N.measureText(e).width)/2;break;case"NOR":case"NXOR":i=this.#D.radiusLeft+(this.#S[t].width-this.#D.radiusLeft-this.#N.measureText(e).width)/2-this.#D.notRadius;break;case"NAND":i=(this.#S[t].width-this.#N.measureText(e).width)/2-this.#D.notRadius;break;case"NOT":i=(this.#S[t].width-this.#N.measureText(e).width)/4;break}this.#N.fillText(e,this.#x[t].left+i,this.#x[t].top+this.#S[t].height/2),this.#N.font=this.#M.font}}#dt(t){this.#T[t]=new Path2D,this.#T[t].moveTo(this.#w[t].left,this.#w[t].top-this.#W.radius),this.#T[t].lineTo(this.#w[t].left+this.#W.radius,this.#w[t].top),this.#T[t].lineTo(this.#w[t].left,this.#w[t].top+this.#W.radius),this.#T[t].lineTo(this.#w[t].left-this.#W.radius,this.#w[t].top),this.#T[t].closePath(),this.#N.stroke(this.#T[t])}#rt(t,e,i){if(t){if(this.#j[e+"*"+i]=new Path2D,this.#j[e+"*"+i].moveTo(this.#w[t+"*exit"].left,this.#w[t+"*exit"].top),this.#M.bezierConnector){var s={left:this.#w[t+"*exit"].left+(this.#w[e+"*"+i].left-this.#w[t+"*exit"].left)/2,top:this.#w[t+"*exit"].top},o={left:s.left,top:this.#w[e+"*"+i].top};this.#j[e+"*"+i].bezierCurveTo(s.left,s.top,o.left,o.top,this.#w[e+"*"+i].left,this.#w[e+"*"+i].top)}else this.#j[e+"*"+i].lineTo(this.#w[e+"*"+i].left,this.#w[e+"*"+i].top);this.#N.stroke(this.#j[e+"*"+i])}}#ct(){if(this.#X.name){var t=this.#y.getType(this.#X.name);"symbolPath"!==this.#X.referencePath||(this.#M.interactive&&"IN"===t?(this.#V.selected=this.#N.isPointInPath(this.#E[this.#X.name],this.#U.offsetX,this.#U.offsetY),this.#v.style.cursor=this.#V.selected?this.#L.pointer:this.#L.grab):["IN","OUT","NOT"].includes(t)?this.#v.style.cursor=this.#L.grab:this.#gt()),this.#yt()}else;}#gt(){var t=this.#x[this.#X.name].left+3*this.#S[this.#X.name].width/5;switch(this.#y.getType(this.#X.name)){case"OR":case"AND":case"XOR":break;case"NOR":case"NAND":case"NXOR":t-=this.#D.notRadius;break}var e=this.#y.getFrom(this.#X.name).length,i=this.#x[this.#X.name].top+this.#S[this.#X.name].height/4,s=this.#x[this.#X.name].top+3*this.#S[this.#X.name].height/4;this.#N.font=this.#F.font;var o=this.#N.measureText(this.#F.up).width,n=this.#N.measureText(this.#F.down).width,h=Math.max(o,n),a=new Path2D,r=new Path2D;this.#N.fillStyle=e>2?this.#F.canDoStrokeStyle:this.#F.cannotDoStrokeStyle,r.rect(t-2,this.#x[this.#X.name].top+3,h+4,this.#S[this.#X.name].height/2-3),a.addPath(r),this.#N.fill(r),this.#N.stroke(r),r=new Path2D,this.#N.fillStyle=e<this.#F.max?this.#F.canDoStrokeStyle:this.#F.cannotDoStrokeStyle,r.rect(t-2,this.#x[this.#X.name].top+this.#S[this.#X.name].height/2,h+4,this.#S[this.#X.name].height/2-3),a.addPath(r),this.#N.fill(r),this.#N.stroke(r),this.#N.fillStyle=this.#M.strokeStyle,this.#N.fillText(this.#F.up,t+(h-o)/2,i),this.#N.fillText(this.#F.down,t+(h-n)/2,s),this.#N.font=this.#M.font,this.#F.selected=this.#N.isPointInPath(a,this.#U.offsetX,this.#U.offsetY),this.#F.name=this.#X.name,this.#F.direction=this.#U.offsetY<this.#x[this.#X.name].top+this.#S[this.#X.name].height/2?"UP":"DOWN",this.#F.selected?"UP"===this.#F.direction&&e>2||"DOWN"===this.#F.direction&&e<this.#F.max?this.#v.style.cursor=this.#L.pointer:this.#v.style.cursor=this.#L.notAllowed:this.#v.style.cursor=this.#L.grab}#yt(){this.#N.lineWidth=this.#X.lineWidth,this.#z.pressed?(this.#v.style.cursor=this.#L.grabbing,this.#N.strokeStyle=this.#xt(this.#v.width,this.#v.height,this.#A.lineWidth,this.#x[this.#X.name].left,this.#x[this.#X.name].top,this.#S[this.#X.name].width,this.#S[this.#X.name].height)?this.#A.strokeStyle:this.#X.strokeStyle):this.#N.strokeStyle="connectorPath"===this.#X.referencePath?this.#A.strokeStyle:this.#X.strokeStyle,this.#N.stroke(this.#Ct(this.#X.referencePath,this.#X.referenceName)),this.#N.lineWidth=this.#M.lineWidth,this.#N.strokeStyle=this.#M.strokeStyle}#lt(){if(this.#W.pressed){if(this.#N.beginPath(),this.#N.moveTo(this.#W.event.offsetX,this.#W.event.offsetY),this.#M.bezierConnector){var t={left:this.#W.event.offsetX+(this.#U.offsetX-this.#W.event.offsetX)/2,top:this.#W.event.offsetY},e={left:t.left,top:this.#U.offsetY};this.#N.bezierCurveTo(t.left,t.top,e.left,e.top,this.#U.offsetX,this.#U.offsetY)}else this.#N.lineTo(this.#U.offsetX,this.#U.offsetY);this.#N.stroke(),this.#W.name&&(this.#N.lineWidth=this.#W.lineWidth,this.#N.strokeStyle=this.#Ot(this.#X.name,this.#X.index,this.#W.name,this.#W.index)?this.#W.canDoStrokeStyle:this.#W.cannotDoStrokeStyle,this.#N.stroke(this.#T[this.#W.referenceName]),this.#N.lineWidth=this.#M.lineWidth,this.#N.strokeStyle=this.#M.strokeStyle)}}#xt(t,e,i,s,o,n,h){var a=t,r=e;t<s?a=s:t>s+n&&(a=s+n),e<o?r=o:e>o+h&&(r=o+h);var c=t-a,l=e-r;return Math.sqrt(c*c+l*l)<=i}#Ct(t,e){switch(t){case"symbolPath":return this.#k[e];case"knobPath":return this.#T[e];case"connectorPath":return this.#j[e]}}#Ot(t,e,i,s){var o=this.#y.getType(t),n=this.#y.getType(i);return("IN"!==o||"IN"!==n)&&("IN"===o&&"OUT"===n?this.#y.isConnectionValid(t,i):"IN"===o?-1!==s&&this.#y.isConnectionValid(t,i):"OUT"===o&&"IN"===n?this.#y.isConnectionValid(i,t):("OUT"!==o||"OUT"!==n)&&("OUT"===o?-1===s&&this.#y.isConnectionValid(i,t):"IN"===n?-1!==e&&this.#y.isConnectionValid(i,t):"OUT"===n?-1===e&&this.#y.isConnectionValid(t,i):(-1!==e||-1!==s)&&((-1===e||-1===s)&&(-1===e?this.#y.isConnectionValid(t,i):-1===s&&this.#y.isConnectionValid(i,t)))))}#q(t){this.#U=t;var e=Math.sqrt(Math.pow(t.offsetX-this.#v.width,2)+Math.pow(t.offsetY-this.#v.height,2));this.#v.setAttribute("title",e<this.#A.radius2?"To trash an element move and release it here":""),this.#z.pressed?(this.#x[this.#X.name].top=t.offsetY-this.#z.offsetTop,this.#x[this.#X.name].left=t.offsetX-this.#z.offsetLeft,this.#P.forEach((t=>t()))):this.#W.pressed?this.#vt(t):this.#Nt(t),this.#$()}#vt(t){for(var e in this.#W.name="",this.#x)switch(this.#y.getType(e)){case"IN":!this.#W.name&&this.#N.isPointInPath(this.#T[e+"*exit"],t.offsetX,t.offsetY)&&(this.#W.name=e,this.#W.index=-1,this.#W.referenceName=e+"*exit");break;case"OUT":this.#y.getFrom(e).forEach(((i,s)=>{!this.#W.name&&this.#N.isPointInPath(this.#T[e+"*"+s],t.offsetX,t.offsetY)&&(this.#W.name=e,this.#W.index=s,this.#W.referenceName=e+"*"+s)}));break;default:!this.#W.name&&this.#N.isPointInPath(this.#T[e+"*exit"],t.offsetX,t.offsetY)&&(this.#W.name=e,this.#W.index=-1,this.#W.referenceName=e+"*exit"),this.#y.getFrom(e).forEach(((i,s)=>{!this.#W.name&&this.#N.isPointInPath(this.#T[e+"*"+s],t.offsetX,t.offsetY)&&(this.#W.name=e,this.#W.index=s,this.#W.referenceName=e+"*"+s)}));break}}#Nt(t){for(var e in this.#X.name="",this.#x){switch(this.#y.getType(e)){case"IN":!this.#X.name&&this.#N.isPointInPath(this.#T[e+"*exit"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=-1,this.#X.referencePath="knobPath",this.#X.referenceName=e+"*exit");break;case"OUT":!this.#X.name&&this.#N.isPointInPath(this.#T[e+"*0"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=0,this.#X.referencePath="knobPath",this.#X.referenceName=e+"*0"),!this.#X.name&&this.#y.getFrom(e)[0]&&this.#N.isPointInStroke(this.#j[e+"*0"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=0,this.#X.referencePath="connectorPath",this.#X.referenceName=e+"*0");break;default:!this.#X.name&&this.#N.isPointInPath(this.#T[e+"*exit"],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=-1,this.#X.referencePath="knobPath",this.#X.referenceName=e+"*exit"),this.#y.getFrom(e).forEach(((i,s)=>{!this.#X.name&&this.#N.isPointInPath(this.#T[e+"*"+s],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=s,this.#X.referencePath="knobPath",this.#X.referenceName=e+"*"+s),!this.#X.name&&i&&this.#N.isPointInStroke(this.#j[e+"*"+s],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.index=s,this.#X.referencePath="connectorPath",this.#X.referenceName=e+"*"+s)}));break}!this.#X.name&&this.#N.isPointInPath(this.#k[e],t.offsetX,t.offsetY)&&(this.#X.name=e,this.#X.referencePath="symbolPath",this.#X.referenceName=e)}}#G(t){if(this.#X.name)switch(this.#X.referencePath){case"knobPath":this.#W.pressed=!0,this.#W.event=t;break;case"symbolPath":if(this.#F.selected){var e=this.#y.getFrom(this.#F.name).length;switch(this.#F.direction){case"UP":e>2&&(this.#y.decConnector(this.#F.name),this.#x[this.#F.name].top+=this.#D.oneHeight/2,this.#I.forEach((t=>t())),this.#P.forEach((t=>t())));break;case"DOWN":e<this.#F.max&&(this.#y.incConnector(this.#F.name),this.#x[this.#F.name].top-=this.#D.oneHeight/2,this.#I.forEach((t=>t())),this.#P.forEach((t=>t())));break}this.#$()}else this.#V.selected?(this.#C[this.#X.name]=!this.#C[this.#X.name],this.#$()):(this.#z.pressed=!0,this.#z.offsetLeft=t.offsetX-this.#x[this.#X.name].left,this.#z.offsetTop=t.offsetY-this.#x[this.#X.name].top,this.#v.style.cursor=this.#L.grabbing);break;case"connectorPath":this.#y.removeConnection(this.#X.name,this.#X.index),this.#X.name="",this.#I.forEach((t=>t())),this.#P.forEach((t=>t())),this.#$();break}}#Z(t){if(this.#X.name&&this.#z.pressed&&this.#xt(this.#v.width,this.#v.height,this.#A.lineWidth,this.#x[this.#X.name].left,this.#x[this.#X.name].top,this.#S[this.#X.name].width,this.#S[this.#X.name].height))this.#y.remove(this.#X.name),delete this.#x[this.#X.name],this.#X.name="",this.#I.forEach((t=>t())),this.#P.forEach((t=>t()));else if(this.#W.pressed&&this.#W.name&&this.#Ot(this.#X.name,this.#X.index,this.#W.name,this.#W.index)){var e=this.#y.getType(this.#X.name),i=this.#y.getType(this.#W.name);"IN"===e?this.#y.addConnection(this.#X.name,this.#W.name,this.#W.index):"IN"===i?this.#y.addConnection(this.#W.name,this.#X.name,this.#X.index):"OUT"===e?this.#y.addConnection(this.#W.name,this.#X.name,0):"OUT"===i?this.#y.addConnection(this.#X.name,this.#W.name,0):-1===this.#X.index?this.#y.addConnection(this.#X.name,this.#W.name,this.#W.index):-1===this.#W.index&&this.#y.addConnection(this.#W.name,this.#X.name,this.#X.index),this.#I.forEach((t=>t())),this.#P.forEach((t=>t()))}this.#W.pressed=!1,this.#z.pressed=!1,this.#F.selected=!1,this.#$()}}